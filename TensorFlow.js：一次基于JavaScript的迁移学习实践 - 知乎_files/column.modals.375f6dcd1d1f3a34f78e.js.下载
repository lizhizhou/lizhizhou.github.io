webpackJsonp([0],{1181:function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},1183:function(e,t,n){var o=n(1287)("wks"),r=n(1288),a=n(1181).Symbol,i="function"==typeof a;(e.exports=function(e){return o[e]||(o[e]=i&&a[e]||(i?a:r)("Symbol."+e))}).store=o},1190:function(e,t){var n=e.exports={version:"2.5.7"};"number"==typeof __e&&(__e=n)},1191:function(e,t,n){var o=n(1202);e.exports=function(e){if(!o(e))throw TypeError(e+" is not an object!");return e}},1197:function(e,t,n){var o=n(1214),r=n(1285);e.exports=n(1203)?function(e,t,n){return o.f(e,t,r(1,n))}:function(e,t,n){return e[t]=n,e}},1202:function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},1203:function(e,t,n){e.exports=!n(1284)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},1204:function(e,t){e.exports={}},1211:function(e,t,n){var o=n(1181),r=n(1190),a=n(1212),i=n(1197),s=n(1215),c=function(e,t,n){var l,u,m,p=e&c.F,d=e&c.G,f=e&c.S,h=e&c.P,v=e&c.B,y=e&c.W,b=d?r:r[t]||(r[t]={}),g=b.prototype,C=d?o:f?o[t]:(o[t]||{}).prototype;d&&(n=t);for(l in n)(u=!p&&C&&void 0!==C[l])&&s(b,l)||(m=u?C[l]:n[l],b[l]=d&&"function"!=typeof C[l]?n[l]:v&&u?a(m,o):y&&C[l]==m?function(e){var t=function(t,n,o){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,o)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(m):h&&"function"==typeof m?a(Function.call,m):m,h&&((b.virtual||(b.virtual={}))[l]=m,e&c.R&&g&&!g[l]&&i(g,l,m)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},1212:function(e,t,n){var o=n(1213);e.exports=function(e,t,n){if(o(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,o){return e.call(t,n,o)};case 3:return function(n,o,r){return e.call(t,n,o,r)}}return function(){return e.apply(t,arguments)}}},1213:function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},1214:function(e,t,n){var o=n(1191),r=n(1602),a=n(1603),i=Object.defineProperty;t.f=n(1203)?Object.defineProperty:function(e,t,n){if(o(e),t=a(t,!0),o(n),r)try{return i(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},1215:function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},1216:function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},1231:function(e,t){var n=Math.ceil,o=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?o:n)(e)}},1232:function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},1233:function(e,t){e.exports=!0},1234:function(e,t,n){var o=n(1202),r=n(1181).document,a=o(r)&&o(r.createElement);e.exports=function(e){return a?r.createElement(e):{}}},1235:function(e,t,n){var o=n(1610),r=n(1232);e.exports=function(e){return o(r(e))}},1236:function(e,t,n){var o=n(1287)("keys"),r=n(1288);e.exports=function(e){return o[e]||(o[e]=r(e))}},1237:function(e,t,n){var o=n(1214).f,r=n(1215),a=n(1183)("toStringTag");e.exports=function(e,t,n){e&&!r(e=n?e:e.prototype,a)&&o(e,a,{configurable:!0,value:t})}},1238:function(e,t,n){"use strict";function o(e){var t,n;this.promise=new e(function(e,o){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=o}),this.resolve=r(t),this.reject=r(n)}var r=n(1213);e.exports.f=function(e){return new o(e)}},1244:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}var r=n(452),a=o(r),i=n(453),s=o(i);e.exports={TransitionGroup:s.default,CSSTransitionGroup:a.default}},1245:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=n(0),u=n.n(l),m=n(2),p=n.n(m),d=n(1309),f=n.n(d),h=n(3),v=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),y=function(e){function t(){var e;o(this,t);for(var n=arguments.length,a=Array(n),i=0;i<n;i++)a[i]=arguments[i];var s=r(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a)));return s.handleClick=function(){var e=s.props;(0,e.clickCallback)(e.page)},s}return a(t,e),v(t,[{key:"render",value:function(){var e=this.props,t=e.text,n=e.isCurrent,o=e.className;return u.a.createElement(h.c,{preset:h.b.Plain,className:p()("PaginationButton",{"PaginationButton--current":n},o),onClick:this.handleClick,disabled:n},t)}}]),t}(l.Component),b=(n(1312),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),g=function(e){function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,e),b(t,[{key:"render",value:function(){var e=this.props.current,n=this.props.total,o=this.props.clickCallback,r=this.props.className,a=t.getPagerList(e,n);return u.a.createElement("div",{className:p()("Pagination",r)},1!==e&&1!==n&&u.a.createElement(y,{className:"PaginationButton-prev",clickCallback:o,text:"上一页",page:e-1}),a.map(function(t,n){return"number"==typeof t?u.a.createElement(y,{clickCallback:o,text:t,page:t,key:n,isCurrent:e===t}):u.a.createElement("span",{key:n,className:"PaginationButton PaginationButton--fake"},t)}),e!==n&&u.a.createElement(y,{className:"PaginationButton-next",clickCallback:o,text:"下一页",page:e+1}))}}],[{key:"getPagerList",value:function(e,t){return t<6?f()(1,t+1):e>=t-2?[1,"..."].concat(f()(t-3,t+1)):e<=3?f()(1,5).concat(["...",t]):[1,"..."].concat(f()(e-1,e)).concat(["...",t])}}]),t}(l.Component);g.defaultProps={current:1,total:1,clickCallback:function(){}},n.d(t,"a",function(){return g}),n.d(t,!1,function(){})},1246:function(e,t,n){"use strict";function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.selectedKey,i=void 0===r?"selectedProps":r,s=n.dropedKey,c=void 0===s?"dropedProps":s;return Object.keys(e).reduce(function(n,r){var s=t.includes(r)?i:c;return a({},n,o({},s,a({},n[s],o({},r,e[r]))))},{})}t.a=r;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}},1247:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o=function(e){return"article"===e?"Post":"book_review"===e?"BookReview":""+e.slice(0,1).toUpperCase()+e.slice(1)}},1281:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n.d(t,"a",function(){return m});var i=n(0),s=n.n(i),c=n(115),l=n(1584),u=(n.n(l),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),m=function(e){function t(){return o(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"render",value:function(){var e=this.props.onRef;return s.a.createElement("div",{className:"Comments-pattern-loading",ref:e},s.a.createElement(c.a,null))}}]),t}(i.PureComponent)},1282:function(e,t,n){e.exports={default:n(1598),__esModule:!0}},1283:function(e,t,n){"use strict";var o=n(1233),r=n(1211),a=n(1604),i=n(1197),s=n(1204),c=n(1605),l=n(1237),u=n(1613),m=n(1183)("iterator"),p=!([].keys&&"next"in[].keys()),d=function(){return this};e.exports=function(e,t,n,f,h,v,y){c(n,t,f);var b,g,C,E=function(e){if(!p&&e in P)return P[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},w=t+" Iterator",O="values"==h,k=!1,P=e.prototype,_=P[m]||P["@@iterator"]||h&&P[h],I=_||E(h),S=h?O?E("entries"):I:void 0,N="Array"==t?P.entries||_:_;if(N&&(C=u(N.call(new e)))!==Object.prototype&&C.next&&(l(C,w,!0),o||"function"==typeof C[m]||i(C,m,d)),O&&_&&"values"!==_.name&&(k=!0,I=function(){return _.call(this)}),o&&!y||!p&&!k&&P[m]||i(P,m,I),s[t]=I,s[w]=d,h)if(b={values:O?I:E("values"),keys:v?I:E("keys"),entries:S},y)for(g in b)g in P||a(P,g,b[g]);else r(r.P+r.F*(p||k),t,b);return b}},1284:function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},1285:function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},1286:function(e,t,n){var o=n(1231),r=Math.min;e.exports=function(e){return e>0?r(o(e),9007199254740991):0}},1287:function(e,t,n){var o=n(1190),r=n(1181),a=r["__core-js_shared__"]||(r["__core-js_shared__"]={});(e.exports=function(e,t){return a[e]||(a[e]=void 0!==t?t:{})})("versions",[]).push({version:o.version,mode:n(1233)?"pure":"global",copyright:"© 2018 Denis Pushkarev (zloirock.ru)"})},1288:function(e,t){var n=0,o=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+o).toString(36))}},1289:function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},1290:function(e,t,n){var o=n(1181).document;e.exports=o&&o.documentElement},1291:function(e,t,n){var o=n(1216),r=n(1183)("toStringTag"),a="Arguments"==o(function(){return arguments}()),i=function(e,t){try{return e[t]}catch(e){}};e.exports=function(e){var t,n,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=i(t=Object(e),r))?n:a?o(t):"Object"==(s=o(t))&&"function"==typeof t.callee?"Arguments":s}},1292:function(e,t,n){var o=n(1191),r=n(1213),a=n(1183)("species");e.exports=function(e,t){var n,i=o(e).constructor;return void 0===i||void 0==(n=o(i)[a])?t:r(n)}},1293:function(e,t,n){var o,r,a,i=n(1212),s=n(1625),c=n(1290),l=n(1234),u=n(1181),m=u.process,p=u.setImmediate,d=u.clearImmediate,f=u.MessageChannel,h=u.Dispatch,v=0,y={},b=function(){var e=+this;if(y.hasOwnProperty(e)){var t=y[e];delete y[e],t()}},g=function(e){b.call(e.data)};p&&d||(p=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return y[++v]=function(){s("function"==typeof e?e:Function(e),t)},o(v),v},d=function(e){delete y[e]},"process"==n(1216)(m)?o=function(e){m.nextTick(i(b,e,1))}:h&&h.now?o=function(e){h.now(i(b,e,1))}:f?(r=new f,a=r.port2,r.port1.onmessage=g,o=i(a.postMessage,a,1)):u.addEventListener&&"function"==typeof postMessage&&!u.importScripts?(o=function(e){u.postMessage(e+"","*")},u.addEventListener("message",g,!1)):o="onreadystatechange"in l("script")?function(e){c.appendChild(l("script")).onreadystatechange=function(){c.removeChild(this),b.call(e)}}:function(e){setTimeout(i(b,e,1),0)}),e.exports={set:p,clear:d}},1294:function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},1295:function(e,t,n){var o=n(1191),r=n(1202),a=n(1238);e.exports=function(e,t){if(o(e),r(t)&&t.constructor===e)return t;var n=a.f(e);return(0,n.resolve)(t),n.promise}},1309:function(e,t,n){var o=n(1310),r=o();e.exports=r},1310:function(e,t,n){function o(e){return function(t,n,o){return o&&"number"!=typeof o&&a(t,n,o)&&(n=o=void 0),t=i(t),void 0===n?(n=t,t=0):n=i(n),o=void 0===o?t<n?1:-1:i(o),r(t,n,o,e)}}var r=n(1311),a=n(262),i=n(266);e.exports=o},1311:function(e,t){function n(e,t,n,a){for(var i=-1,s=r(o((t-e)/(n||1)),0),c=Array(s);s--;)c[a?s:++i]=e,e+=n;return c}var o=Math.ceil,r=Math.max;e.exports=n},1312:function(e,t){},1313:function(e,t){e.exports={attributes:{width:"72px",height:"58px",viewBox:"0 0 72 58"},content:'<defs>         <path d="M0.00434937116,11.7604183 C0.0014585125,11.8367351 0,11.9134174 0,11.9904392 L0,52.0095608 C0,55.3137533 2.68603825,58 5.99943435,58 L66.0005656,58 C69.3089213,58 72,55.317989 72,52.0095608 L72,11.9904392 C72,8.68624675 69.3139617,6 66.0005656,6 L31.1520961,6 L30.2346555,3.7077864 C29.4154984,1.66113281 26.9585394,0 24.7478675,0 L6.18638069,0 C2.86742525,0 0.139552484,2.68348852 0.0902454792,5.99373937 L0.00434937116,11.7604183 Z" id="path-1"></path>         <mask id="mask-2" maskContentUnits="userSpaceOnUse" maskUnits="objectBoundingBox" x="0" y="0" width="72" height="58" fill="white">             <use xlink:href="#path-1"></use>         </mask>     </defs>     <g id="空状态" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">         <g id="collection" transform="translate(-39.000000, -30.000000)" stroke="#E7EAF1">             <g transform="translate(39.000000, 30.000000)" id="Group-7">                 <g>                     <use id="Combined-Shape" mask="url(#mask-2)" stroke-width="6" xlink:href="#path-1"></use>                     <path d="M36.4126782,38.4800003 L30.2669271,41.2927815 C29.7656337,41.522213 29.4096881,41.2718295 29.4738593,40.716584 L30.2498317,34.0024302 L25.6755762,29.0266708 C25.3024658,28.6208107 25.4306014,28.2049135 25.9785012,28.0943637 L32.6038296,26.7575697 L35.9225353,20.8696 C36.1932338,20.3893332 36.6283715,20.3826781 36.9028211,20.8696 L40.2215268,26.7575697 L46.8468552,28.0943637 C47.3872665,28.2034026 47.5280608,28.6151866 47.1497802,29.0266708 L42.5755247,34.0024302 L43.3514971,40.716584 C43.4147912,41.2642406 43.0666691,41.5253922 42.5584293,41.2927815 L36.4126782,38.4800003 Z" id="Star" stroke-width="3"></path>                 </g>             </g>         </g>     </g>'}},1314:function(e,t){},1582:function(e,t){},1583:function(e,t){},1584:function(e,t){},1585:function(e,t){},1586:function(e,t,n){function o(e,t,n){var o=null==e?0:e.length;if(!o)return-1;var l=o-1;return void 0!==n&&(l=i(n),l=n<0?s(o+l,0):c(l,o-1)),r(e,a(t,3),l,!0)}var r=n(264),a=n(117),i=n(458),s=Math.max,c=Math.min;e.exports=o},1587:function(e,t){},1588:function(e,t){},1589:function(e,t){},1590:function(e,t){},1591:function(e,t){},1592:function(e,t){},1593:function(e,t){},1594:function(e,t){},1595:function(e,t){},1596:function(e,t,n){"use strict";t.__esModule=!0;var o=n(1597),r=function(e){return e&&e.__esModule?e:{default:e}}(o);t.default=r.default},1597:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var r=n(1282),a=o(r),i=n(1633),s=o(i),c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.version,n=void 0===t?"3.0.16":t,o=e.hasButton,r=void 0===o||o;return new a.default(function(e,t){var o="//zhstatic.zhihu.com/assets/zfeedback/"+n+"/zfeedback.js",a=function(){return t("zfeedback sdk 加载失败！")},i=function(){if(!window.zfeedback)return void t("zfeedback sdk 初始化失败！");window.zfeedback.init({hasButton:r}),e()},c=function(){return(0,s.default)(o).then(i,a)};"loading"!==document.readyState?c():document.addEventListener("DOMContentLoaded",c)})},l=function(e){window.zfeedbackConfig||(window.zfeedbackConfig={}),window.zfeedbackConfig.user={hash:e}},u=function(e){window.zfeedbackConfig||(window.zfeedbackConfig={}),window.zfeedbackConfig.extra=e};t.default={init:c,setUserHash:l,setExtra:u}},1598:function(e,t,n){n(1599),n(1600),n(1615),n(1619),n(1631),n(1632),e.exports=n(1190).Promise},1599:function(e,t){},1600:function(e,t,n){"use strict";var o=n(1601)(!0);n(1283)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=o(t,n),this._i+=e.length,{value:e,done:!1})})},1601:function(e,t,n){var o=n(1231),r=n(1232);e.exports=function(e){return function(t,n){var a,i,s=String(r(t)),c=o(n),l=s.length;return c<0||c>=l?e?"":void 0:(a=s.charCodeAt(c),a<55296||a>56319||c+1===l||(i=s.charCodeAt(c+1))<56320||i>57343?e?s.charAt(c):a:e?s.slice(c,c+2):i-56320+(a-55296<<10)+65536)}}},1602:function(e,t,n){e.exports=!n(1203)&&!n(1284)(function(){return 7!=Object.defineProperty(n(1234)("div"),"a",{get:function(){return 7}}).a})},1603:function(e,t,n){var o=n(1202);e.exports=function(e,t){if(!o(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!o(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!o(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!o(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},1604:function(e,t,n){e.exports=n(1197)},1605:function(e,t,n){"use strict";var o=n(1606),r=n(1285),a=n(1237),i={};n(1197)(i,n(1183)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=o(i,{next:r(1,n)}),a(e,t+" Iterator")}},1606:function(e,t,n){var o=n(1191),r=n(1607),a=n(1289),i=n(1236)("IE_PROTO"),s=function(){},c=function(){var e,t=n(1234)("iframe"),o=a.length;for(t.style.display="none",n(1290).appendChild(t),t.src="javascript:",e=t.contentWindow.document,e.open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;o--;)delete c.prototype[a[o]];return c()};e.exports=Object.create||function(e,t){var n;return null!==e?(s.prototype=o(e),n=new s,s.prototype=null,n[i]=e):n=c(),void 0===t?n:r(n,t)}},1607:function(e,t,n){var o=n(1214),r=n(1191),a=n(1608);e.exports=n(1203)?Object.defineProperties:function(e,t){r(e);for(var n,i=a(t),s=i.length,c=0;s>c;)o.f(e,n=i[c++],t[n]);return e}},1608:function(e,t,n){var o=n(1609),r=n(1289);e.exports=Object.keys||function(e){return o(e,r)}},1609:function(e,t,n){var o=n(1215),r=n(1235),a=n(1611)(!1),i=n(1236)("IE_PROTO");e.exports=function(e,t){var n,s=r(e),c=0,l=[];for(n in s)n!=i&&o(s,n)&&l.push(n);for(;t.length>c;)o(s,n=t[c++])&&(~a(l,n)||l.push(n));return l}},1610:function(e,t,n){var o=n(1216);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==o(e)?e.split(""):Object(e)}},1611:function(e,t,n){var o=n(1235),r=n(1286),a=n(1612);e.exports=function(e){return function(t,n,i){var s,c=o(t),l=r(c.length),u=a(i,l);if(e&&n!=n){for(;l>u;)if((s=c[u++])!=s)return!0}else for(;l>u;u++)if((e||u in c)&&c[u]===n)return e||u||0;return!e&&-1}}},1612:function(e,t,n){var o=n(1231),r=Math.max,a=Math.min;e.exports=function(e,t){return e=o(e),e<0?r(e+t,0):a(e,t)}},1613:function(e,t,n){var o=n(1215),r=n(1614),a=n(1236)("IE_PROTO"),i=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=r(e),o(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?i:null}},1614:function(e,t,n){var o=n(1232);e.exports=function(e){return Object(o(e))}},1615:function(e,t,n){n(1616);for(var o=n(1181),r=n(1197),a=n(1204),i=n(1183)("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<s.length;c++){var l=s[c],u=o[l],m=u&&u.prototype;m&&!m[i]&&r(m,i,l),a[l]=a.Array}},1616:function(e,t,n){"use strict";var o=n(1617),r=n(1618),a=n(1204),i=n(1235);e.exports=n(1283)(Array,"Array",function(e,t){this._t=i(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,r(1)):"keys"==t?r(0,n):"values"==t?r(0,e[n]):r(0,[n,e[n]])},"values"),a.Arguments=a.Array,o("keys"),o("values"),o("entries")},1617:function(e,t){e.exports=function(){}},1618:function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},1619:function(e,t,n){"use strict";var o,r,a,i,s=n(1233),c=n(1181),l=n(1212),u=n(1291),m=n(1211),p=n(1202),d=n(1213),f=n(1620),h=n(1621),v=n(1292),y=n(1293).set,b=n(1626)(),g=n(1238),C=n(1294),E=n(1627),w=n(1295),O=c.TypeError,k=c.process,P=k&&k.versions,_=P&&P.v8||"",I=c.Promise,S="process"==u(k),N=function(){},j=r=g.f,T=!!function(){try{var e=I.resolve(1),t=(e.constructor={})[n(1183)("species")]=function(e){e(N,N)};return(S||"function"==typeof PromiseRejectionEvent)&&e.then(N)instanceof t&&0!==_.indexOf("6.6")&&-1===E.indexOf("Chrome/66")}catch(e){}}(),R=function(e){var t;return!(!p(e)||"function"!=typeof(t=e.then))&&t},x=function(e,t){if(!e._n){e._n=!0;var n=e._c;b(function(){for(var o=e._v,r=1==e._s,a=0;n.length>a;)!function(t){var n,a,i,s=r?t.ok:t.fail,c=t.resolve,l=t.reject,u=t.domain;try{s?(r||(2==e._h&&D(e),e._h=1),!0===s?n=o:(u&&u.enter(),n=s(o),u&&(u.exit(),i=!0)),n===t.promise?l(O("Promise-chain cycle")):(a=R(n))?a.call(n,c,l):c(n)):l(o)}catch(e){u&&!i&&u.exit(),l(e)}}(n[a++]);e._c=[],e._n=!1,t&&!e._h&&A(e)})}},A=function(e){y.call(c,function(){var t,n,o,r=e._v,a=L(e);if(a&&(t=C(function(){S?k.emit("unhandledRejection",r,e):(n=c.onunhandledrejection)?n({promise:e,reason:r}):(o=c.console)&&o.error&&o.error("Unhandled promise rejection",r)}),e._h=S||L(e)?2:1),e._a=void 0,a&&t.e)throw t.v})},L=function(e){return 1!==e._h&&0===(e._a||e._c).length},D=function(e){y.call(c,function(){var t;S?k.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})})},M=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,t._a||(t._a=t._c.slice()),x(t,!0))},F=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw O("Promise can't be resolved itself");(t=R(e))?b(function(){var o={_w:n,_d:!1};try{t.call(e,l(F,o,1),l(M,o,1))}catch(e){M.call(o,e)}}):(n._v=e,n._s=1,x(n,!1))}catch(e){M.call({_w:n,_d:!1},e)}}};T||(I=function(e){f(this,I,"Promise","_h"),d(e),o.call(this);try{e(l(F,this,1),l(M,this,1))}catch(e){M.call(this,e)}},o=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},o.prototype=n(1628)(I.prototype,{then:function(e,t){var n=j(v(this,I));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=S?k.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&x(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),a=function(){var e=new o;this.promise=e,this.resolve=l(F,e,1),this.reject=l(M,e,1)},g.f=j=function(e){return e===I||e===i?new a(e):r(e)}),m(m.G+m.W+m.F*!T,{Promise:I}),n(1237)(I,"Promise"),n(1629)("Promise"),i=n(1190).Promise,m(m.S+m.F*!T,"Promise",{reject:function(e){var t=j(this);return(0,t.reject)(e),t.promise}}),m(m.S+m.F*(s||!T),"Promise",{resolve:function(e){return w(s&&this===i?I:this,e)}}),m(m.S+m.F*!(T&&n(1630)(function(e){I.all(e).catch(N)})),"Promise",{all:function(e){var t=this,n=j(t),o=n.resolve,r=n.reject,a=C(function(){var n=[],a=0,i=1;h(e,!1,function(e){var s=a++,c=!1;n.push(void 0),i++,t.resolve(e).then(function(e){c||(c=!0,n[s]=e,--i||o(n))},r)}),--i||o(n)});return a.e&&r(a.v),n.promise},race:function(e){var t=this,n=j(t),o=n.reject,r=C(function(){h(e,!1,function(e){t.resolve(e).then(n.resolve,o)})});return r.e&&o(r.v),n.promise}})},1620:function(e,t){e.exports=function(e,t,n,o){if(!(e instanceof t)||void 0!==o&&o in e)throw TypeError(n+": incorrect invocation!");return e}},1621:function(e,t,n){var o=n(1212),r=n(1622),a=n(1623),i=n(1191),s=n(1286),c=n(1624),l={},u={},t=e.exports=function(e,t,n,m,p){var d,f,h,v,y=p?function(){return e}:c(e),b=o(n,m,t?2:1),g=0;if("function"!=typeof y)throw TypeError(e+" is not iterable!");if(a(y)){for(d=s(e.length);d>g;g++)if((v=t?b(i(f=e[g])[0],f[1]):b(e[g]))===l||v===u)return v}else for(h=y.call(e);!(f=h.next()).done;)if((v=r(h,b,f.value,t))===l||v===u)return v};t.BREAK=l,t.RETURN=u},1622:function(e,t,n){var o=n(1191);e.exports=function(e,t,n,r){try{return r?t(o(n)[0],n[1]):t(n)}catch(t){var a=e.return;throw void 0!==a&&o(a.call(e)),t}}},1623:function(e,t,n){var o=n(1204),r=n(1183)("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(o.Array===e||a[r]===e)}},1624:function(e,t,n){var o=n(1291),r=n(1183)("iterator"),a=n(1204);e.exports=n(1190).getIteratorMethod=function(e){if(void 0!=e)return e[r]||e["@@iterator"]||a[o(e)]}},1625:function(e,t){e.exports=function(e,t,n){var o=void 0===n;switch(t.length){case 0:return o?e():e.call(n);case 1:return o?e(t[0]):e.call(n,t[0]);case 2:return o?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return o?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return o?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},1626:function(e,t,n){var o=n(1181),r=n(1293).set,a=o.MutationObserver||o.WebKitMutationObserver,i=o.process,s=o.Promise,c="process"==n(1216)(i);e.exports=function(){var e,t,n,l=function(){var o,r;for(c&&(o=i.domain)&&o.exit();e;){r=e.fn,e=e.next;try{r()}catch(o){throw e?n():t=void 0,o}}t=void 0,o&&o.enter()};if(c)n=function(){i.nextTick(l)};else if(!a||o.navigator&&o.navigator.standalone)if(s&&s.resolve){var u=s.resolve(void 0);n=function(){u.then(l)}}else n=function(){r.call(o,l)};else{var m=!0,p=document.createTextNode("");new a(l).observe(p,{characterData:!0}),n=function(){p.data=m=!m}}return function(o){var r={fn:o,next:void 0};t&&(t.next=r),e||(e=r,n()),t=r}}},1627:function(e,t,n){var o=n(1181),r=o.navigator;e.exports=r&&r.userAgent||""},1628:function(e,t,n){var o=n(1197);e.exports=function(e,t,n){for(var r in t)n&&e[r]?e[r]=t[r]:o(e,r,t[r]);return e}},1629:function(e,t,n){"use strict";var o=n(1181),r=n(1190),a=n(1214),i=n(1203),s=n(1183)("species");e.exports=function(e){var t="function"==typeof r[e]?r[e]:o[e];i&&t&&!t[s]&&a.f(t,s,{configurable:!0,get:function(){return this}})}},1630:function(e,t,n){var o=n(1183)("iterator"),r=!1;try{var a=[7][o]();a.return=function(){r=!0},Array.from(a,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!r)return!1;var n=!1;try{var a=[7],i=a[o]();i.next=function(){return{done:n=!0}},a[o]=function(){return i},e(a)}catch(e){}return n}},1631:function(e,t,n){"use strict";var o=n(1211),r=n(1190),a=n(1181),i=n(1292),s=n(1295);o(o.P+o.R,"Promise",{finally:function(e){var t=i(this,r.Promise||a.Promise),n="function"==typeof e;return this.then(n?function(n){return s(t,e()).then(function(){return n})}:e,n?function(n){return s(t,e()).then(function(){throw n})}:e)}})},1632:function(e,t,n){"use strict";var o=n(1211),r=n(1238),a=n(1294);o(o.S,"Promise",{try:function(e){var t=r.f(this),n=a(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},1633:function(e,t,n){"use strict";function o(e){return new a.default(function(t,n){function o(){r.onload=r.onerror=r.onreadystatechange=null,document.body.removeChild(r)}var r=document.createElement("script");r.onload=function(){o(),t()},r.onerror=function(){o(),n()},r.onreadystatechange=function(){"loaded"!==r.readyState&&"complete"!==r.readyState||onload()},r.src=e,document.body.appendChild(r)})}t.__esModule=!0;var r=n(1282),a=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default=o},1634:function(e,t){},1635:function(e,t){},1636:function(e,t){},1637:function(e,t){},1638:function(e,t){},1639:function(e,t){},1643:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){switch(e){case"answer":return Object(V.c)(t);case"article":return Object(q.b)(t);default:return null}}function s(e,t){var n=t.parent,o=t.parent,r=o.type,a=o.id,i=t.status,s=t.order,c=t.byComment,l=t.commentPattern,u=e.entities,m=e.comments,p=r+"_"+a,d=m.parent,f=m.pagination;"reviewing"===i&&(f=m.reviewing),"reverse"===s&&"open"===i&&(f=m.reverse);var h=[],v=m.collapsed[p]||{};v&&v.ids&&v.ids.length>0&&(h=v.ids.map(function(e){return u.comments[e]}));var y=f[p]||{isPrevDrained:!1,isFetching:!1,isDrained:!1,ids:[]},b=y.isFetching,g=y.isPrevDrained,C=y.isDrained,E=y.ids,w=y.newIds,O=void 0===w?[]:w;return{isFetching:b,isPrevDrained:g,isDrained:C,totals:y.totals,comments:("bottom"!==l?E:O).map(function(e){return u.comments[e]}),collapsedInfo:v,collapsedComments:h,targetComment:u.comments[c],parent:Y({},n,d[p])}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function m(e,t){var n=t.commentId,o=e.entities.comments,r=e.comments.conversation,a=r[n]||{isFetching:!1,isDrained:!1,ids:[]};return{isFetching:a.isFetching,isDrained:a.isDrained,comments:a.ids.map(function(e){return o[e]}),openComment:o[n]}}function p(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var v,y,b,g,C,E,w,O=n(1),k=n.n(O),P=n(0),_=n.n(P),I=n(4),S=n(2),N=n.n(S),j=n(64),T=n(1244),R=n(55),x=n(80),A=n.n(x),L=n(7),D=n(79),M=n(1245),F=n(29),B=n(12),V=n(83),q=n(66),U=n(257),z=n(449),W=n(451),G=n(1281),H=n(441),K=(n(1585),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),Y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Q=(y=v=function(e){function t(e,n){o(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return a.state={collapsed:!0,current:1,packupButtonStatus:!1,packupButtonLeft:0},a.handleOpenCollapsed=function(){a.setState({collapsed:!1}),a.load(a.props,!1,!0)},a.createOnRef=A()(function(e){return function(t){var n=a.props.byComment;e===Number(n)&&(a.targetCommentEl=t)}}),a.handlePaginationClick=function(e){var t=a.props.onPaginationClick,n=a.state.current;t&&t(n,e),a.commentsElement.scrollIntoView(),a.setState({current:e}),a.loadByPagination(e)},a.renderComment=function(e){var t=a.props,n=t.parent,o=n.type,r=n.author;r=void 0===r?{isOrg:!1}:r;var i=r.isOrg,s=t.isMobile,c=t.parent,l=t.commentNeedsReview,u=t.onShowConversation,m=t.status,p=t.onItemLike,d=t.onItemDelete,f=t.onItemCollapse,h=t.onItemDislike,v=t.onItemApprove,y=t.canOperateItem,b=t.commentPattern;return _.a.createElement(W.a,{key:e.id,isMobile:s,comment:e,onRef:a.createOnRef(e.id),status:m,type:o,parent:c,canOperate:y,commentNeedsReview:l,onShowConversation:u,ownerAuthorIsOrg:i,onLike:p,onReply:a.addComment,onFeature:a.featureItem,onDelete:d,onCollapse:f,onDislike:h,onApprove:v,commentPattern:b})},a.renderNormalComments=function(e){var t=a.state.collapsed,n=a.props.byComment,o=[];if(a.lastFeaturedIndex=0,e.length>0){var r=e[0].featured,i=!1;e.forEach(function(s,c){if(n||!s.collapsed){var l=e[c-1];if(!s.collapsed||(l&&l.collapsed||o.push(a.renderCollapsedDivider()),!t)){o.push(a.renderComment(s));var u=e[c+1];r&&!i&&s.featured&&(!u||!u.featured)&&(i=!0,a.lastFeaturedIndex=c,o.push(_.a.createElement("div",{className:"CommentList-divider",key:"divider-featured"},_.a.createElement("div",{className:"CommentList-dividerLine"}),_.a.createElement("div",{className:"CommentList-dividerText"},"以上为精选评论",_.a.createElement(L.M,{className:"CommentList-questionMark","data-tooltip":"精选评论包含回答作者推荐的评论和部分高赞评论",center:!0,size:16})))))}}})}return o},a.renderCollapsedComments=function(){var e=[],t=a.props.collapsedComments;return a.state.collapsed||!t||t.length<=0?[]:(e.push(t.map(function(e){return a.renderComment(e)})),e)},a.renderComments=function(e){return e.map(a.renderComment)},a.load=a.load.bind(a),a.loadByPagination=a.loadByPagination.bind(a),a.addComment=a.addComment.bind(a),a.featureItem=a.featureItem.bind(a),a.handleScroll=a.handleScroll.bind(a),a}return a(t,e),K(t,[{key:"componentDidMount",value:function(){this.subscription=Object(R.subscribe)("scroll",this.handleScroll);var e=this.props,t=e.byComment,n=e.commentPattern,o=e.parent.adminClosedComment,r=this.state.current;t&&this.scrollToTarget(),"bottom"!==n||o||(this.loadByPagination(r),this.commentsWithPaginationEl&&this.setState({packupButtonLeft:this.commentsWithPaginationEl.getBoundingClientRect().right-16}))}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.order,o=t.status,r=t.targetComment,a=t.commentPattern;n===e.order&&o===e.status||("bottom"===a?(this.setState({current:1}),this.loadByPagination(1,e)):this.load(e),this.setState({collapsed:!0}));var i=e.targetComment;!r&&i&&this.setState({collapsed:!i.collapsed})}},{key:"componentDidUpdate",value:function(e){!e.comments.length&&this.props.comments.length&&this.props.byComment&&this.scrollToTarget()}},{key:"componentWillUnmount",value:function(){this.props.dispatch(Object(B.d)(B.b)),this.subscription&&this.subscription.unsubscribe()}},{key:"load",value:function(e,t,n){if(!this.props.isFetching&&!this.props.parent.adminClosedComment){var o=e||this.props,r=o.order,a=o.byComment,s=o.status,c=o.parent,l=c.id,u=c.type,m=o.dispatch,p=o.commentPattern;if(o.needLoadCommentPermission&&i(u,l)&&m(i(u,l)),n){m(Object(j.e)(u,l,{order:r,isPrevious:t,byComment:a,status:"collapsed",commentPattern:p},!0))}else m(Object(j.e)(u,l,{order:r,isPrevious:t,byComment:a,status:s,commentPattern:p}))}}},{key:"addComment",value:function(e,t){var n=this.props,o=n.parent,r=o.id,a=o.type,i=n.dispatch,s=[a,r,e];return t&&(s[3]=t.id),i(j.a.apply(void 0,s))}},{key:"featureItem",value:function(e){this.props.onItemFeature(e,this.lastFeaturedIndex)}},{key:"handleScroll",value:function(){if(this.commentsElement&&this.commentsWithPaginationEl){var e=window.innerHeight,t=this.state.packupButtonStatus,n=this.commentsWithPaginationEl.getBoundingClientRect(),o=n.top,r=n.bottom,a=n.height;!t&&a>500&&r>e&&o<0?this.setState({packupButtonStatus:!0}):t&&(a<=500||r<=e||o>=0)&&this.setState({packupButtonStatus:!1})}}},{key:"scrollToTarget",value:function(){var e=this.targetCommentEl,t=this.listEl;if(t&&e){var n=e.getBoundingClientRect(),o=n.top,r=n.height,a=t.getBoundingClientRect(),i=a.top,s=a.height;this.listEl.scrollTop+=o-i-(s-r)/2,e.classList.add("CommentItem--highlighted"),setTimeout(function(){return e.classList.remove("CommentItem--highlighted")},2e3),e.tabIndex=-1,e.focus()}}},{key:"loadByPagination",value:function(e,t){var n=t||this.props,o=n.order,r=n.byComment,a=n.status,s=n.parent,c=s.id,l=s.type,u=n.dispatch,m=n.commentPattern;n.needLoadCommentPermission&&i(l,c)&&u(i(l,c)),u(Object(j.e)(l,c,{order:o,isPrevious:!1,byComment:r,status:a,commentPattern:m,current:e}))}},{key:"renderCollapsedDivider",value:function(){var e=this.props,t=e.isDrained,n=e.parent.collapsedCounts;return!t||n<=0?[]:this.state.collapsed?_.a.createElement("div",{className:"CommentList-action",key:"collapsed"},_.a.createElement("div",{className:"CommentList-expendCollapseButton"},_.a.createElement("span",{onClick:this.handleOpenCollapsed},Object(F.a)(n)," 条评论被折叠"),"（",_.a.createElement("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）")):_.a.createElement("div",{className:"CommentList-divider",key:"divider-collapsed"},_.a.createElement("div",{className:"CommentList-dividerLine"}),_.a.createElement("div",{className:"CommentList-dividerText"},Object(F.a)(n)," 条评论被折叠（",_.a.createElement("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）"))}},{key:"renderCollapsedInfiLoader",value:function(){var e=this,t=this.state.collapsed;if(t)return[];var n=this.props.collapsedInfo;n=void 0===n?{}:n;var o=n.isFetching,r=n.isPrevDrained,a=n.isDrained;return _.a.createElement(D.b,{className:"CommentList",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:o,isPrevDrained:r,isDrained:a,onLoad:function(n){return e.load(e.props,n,!t)},placeholder:_.a.createElement(D.a,{className:"CommentItem",small:!0})},this.renderCollapsedComments())}},{key:"renderPatternContent",value:function(e){var t=this,n=this.props,o=n.isFetching,r=n.parent.adminClosedComment,a=n.byComment,i=n.status,s=n.order,c=n.totals,l=n.handlePackupButton,u=n.apps,m=Math.ceil(c/20),p=this.state,d=p.current,f=p.packupButtonStatus,h=p.packupButtonLeft;return r?null:o?_.a.createElement(G.a,{onRef:function(e){t.commentsWithPaginationEl=e}}):_.a.createElement("div",{ref:function(e){t.commentsWithPaginationEl=e}},_.a.createElement("div",{className:"CommentList"},"normal"===s&&"open"===i?this.renderNormalComments(e):this.renderComments(e)),m>1&&_.a.createElement(M.a,{current:d,className:"comments-pagination",total:m,clickCallback:this.handlePaginationClick}),!a&&this.renderCollapsedDivider(),!a&&this.renderCollapsedInfiLoader(),_.a.createElement(T.CSSTransitionGroup,{transitionName:"Comments-Packup-Button",transitionEnterTimeout:300,transitionLeaveTimeout:300},f&&"column"!==u&&_.a.createElement("button",{onClick:l,className:"Comments-Packup-Button",style:{left:h}},"收起评论",_.a.createElement(L.g,{center:!0}))))}},{key:"renderModalContent",value:function(e){var t=this,n=this.props,o=n.collapsedInfo,r=n.parent.adminClosedComment,a=n.status,i=n.order,s=n.byComment,c=this.state.collapsed,l=c?this.props:o,u=l.isFetching,m=l.isDrained,p=l.isPrevDrained;if(m&&e.length<=0||r)return _.a.createElement("div",{className:"Comments-empty"},_.a.createElement(U.a,{entityType:"comments"}));var d={getContainer:function(e){return e}};return _.a.createElement(D.b,Y({className:"CommentList",onRef:function(e){t.listEl=e},isLocal:!0,isLoading:u,isPrevDrained:p,isDrained:m,onLoad:function(e){return t.load(t.props,e,!c)},placeholder:_.a.createElement(D.a,{className:"CommentItem",small:!0})},d),"normal"===i&&"open"===a?this.renderNormalComments(e):this.renderComments(e),!s&&this.renderCollapsedDivider(),!s&&this.renderCollapsedComments())}},{key:"renderCommentEdit",value:function(){var e=this.props,t=e.parent,n=t.canComment;n=void 0===n?{status:!0}:n;var o=n.status,r=n.reason,a=t.author;a=void 0===a?{isOrg:!1}:a;var i=a.isOrg,s=t.type,c=t.id,l=t.adminClosedComment,u=t.questionType,m=e.byComment,p=e.isAutoblur,d=e.commentNeedsReview,f=l?"当前内容暂时无法评论":r,h=p?!p:!m;return o&&!l?_.a.createElement(z.a,{className:"Comments-footer",type:s,id:c,commentNeedsReview:d,onSubmit:this.addComment,autoFocus:h,ownerAuthorIsOrg:i,ownerAuthorIsBrand:"commercial"===u}):_.a.createElement("div",{className:N()("Comments-disabledText",{"Comments-disabledText--fixed":void 0})},_.a.createElement("div",{className:"Comments-disabledReason"},f))}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,o=t.isAuthor,r=t.comments,a=t.commentPattern,i=t.parent,s=i.author;s=void 0===s?{isOrg:!1}:s;var c=s.isOrg,l=i.commentPermission,u=i.reviewingCounts,m=i.commentCount,p=i.adminClosedComment,d=t.totals,f=t.status,h=t.order,v=t.onStatusChange,y=t.apps,b=t.onOrderChange,g=t.targetLink,C=r.filter(function(e){return!e.isDelete}),E="censor"===l&&o,w=E?{isCommentReviewer:E,onStatusChange:v,status:f,reviewingCounts:u}:{status:f},O=N()({Comments:!0,"Comments--withEditor":!0,"Comments-withPagination":"bottom"===a},n);return _.a.createElement("div",{className:O,ref:function(t){e.commentsElement=t}},_.a.createElement(H.a,Y({commentCount:void 0!==m?m:d,commentClosed:p,targetLink:g,order:h,onOrderChange:b,commentPattern:a,isOrg:c},w)),"column"===y&&this.renderCommentEdit(),"bottom"===a?this.renderPatternContent(C):this.renderModalContent(C),"column"!==y&&this.renderCommentEdit())}}]),t}(P.Component),v.propTypes={type:k.a.string,parent:k.a.object.isRequired,targetLink:k.a.node,commentNeedsReview:k.a.bool,byComment:k.a.oneOfType([k.a.number,k.a.string]),commentPattern:k.a.string,handlePackupButton:k.a.func,onPaginationClick:k.a.func,isAutoblur:k.a.bool},v.contextTypes={authRequired:k.a.func.isRequired},v.defaultProps={isAutoblur:!1},y),J=Object(I.connect)(s)(Q),Z=n(15),$=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),X=(g=b=function(e){function t(e,n){c(this,t);var o=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return o.load=o.load.bind(o),o.addComment=n.authRequired(o.addComment.bind(o),void 0,B.b),o}return u(t,e),$(t,[{key:"componentDidMount",value:function(){this.load()}},{key:"load",value:function(){this.props.dispatch(Object(j.f)(this.props.commentId))}},{key:"addComment",value:function(e,t){var n=this.props,o=n.parent,r=o.type,a=o.id,i=n.commentId,s=n.dispatch,c=[r,a,e,t.id,i];return s(j.a.apply(void 0,c))}},{key:"render",value:function(){var e=this.props,t=e.onItemLike,n=e.onItemDelete,o=e.onItemFeature,r=e.onItemApprove,a=e.onItemCollapse,i=e.onItemDislike,s=e.onNavBack,c=e.canOperateItem,l=e.isFetching,u=e.comments,m=e.commentNeedsReview,p=e.openComment.collapsed,d=e.parent,f=e.parent.canComment;f=void 0===f?{status:!0}:f;var h=f.status,v=f.reason,y=e.commentPattern,b=e.commentId,g=this.context.currentUser,C=Boolean(g&&u.find(function(e){return e.author&&e.author.member.urlToken===g.urlToken})),E=void 0,w=void 0;C&&(E=u.filter(function(e){return e.author&&e.author.member.urlToken!==g.urlToken}),w=E[E.length-1]);var O=void 0;return l&&!u.length?O=_.a.createElement(D.a,{className:"CommentItem",small:!0}):u.length&&(O=u.map(function(e,s){return _.a.createElement(W.a,{key:s,isConversation:!0,commentNeedsReview:m,canOperate:c,parent:d,comment:e,onLike:t,onDelete:n,onFeature:o,onApprove:r,onCollapse:a,onDislike:i,collapsedShown:p})})),"bottom"===y?_.a.createElement(Z.b,{size:"fullPage",onClose:s},_.a.createElement("div",{className:"Comments"},_.a.createElement(H.a,{isConversation:!0,commentPattern:y}),_.a.createElement("div",{className:"CommentList"},O))):_.a.createElement("div",{className:"Comments"},_.a.createElement(H.a,{isConversation:!0,onNavBack:s}),_.a.createElement("div",{className:"CommentList"},O),w&&(h?_.a.createElement(z.a,{id:b,type:"conversation",className:"Comments-footer",replyTo:w,commentNeedsReview:m,onSubmit:this.addComment}):_.a.createElement("div",{className:"Comments-disabledText"},v)))}}]),t}(P.Component),b.propTypes={commentId:k.a.number.isRequired,type:k.a.string,parent:k.a.object.isRequired,commentNeedsReview:k.a.bool},b.contextTypes={currentUser:k.a.object,authRequired:k.a.func.isRequired},g),ee=Object(I.connect)(m)(X),te=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},ne=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),oe=(E=C=function(e){function t(e){d(this,t);var n=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));w.call(n);var o=e.parent,r=e.dispatch;return n.feature=function(e,t){return r(Object(j.i)(e,o.id,o.type,t))},n.delete=function(e){return r(Object(j.d)(e,o.type,o.id))},n.showConversation=function(e){return n.setState({openedCommentId:e})},n.showComments=function(){return n.setState({openedCommentId:null})},n}return h(t,e),ne(t,[{key:"componentDidMount",value:function(){var e=this.props.onMount;e&&e(this.domNode)}},{key:"render",value:function(){var e=this,t=this.props,n=t.parent,o=t.commentPattern,r=t.type,a=t.parent;a=void 0===a?{}:a;var i=a.commentPermission,s=a.relationship,c=void 0===s?{}:s,l=a.author,u=void 0===l?{}:l,m=t.needLoadCommentPermission,d=p(t,["parent","commentPattern","type","parent","needLoadCommentPermission"]),f=this.context.currentUser,h=void 0===c.isAuthor?f&&u.urlToken&&f.urlToken===u.urlToken:c.isAuthor,v="censor"===i&&!h,y="answer"===r||"article"===r,b=this.state,g=b.openedCommentId,C=b.status,E=b.order,w={commentNeedsReview:v,parent:n,type:r,canOperateItem:y,onShowConversation:this.showConversation,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve};return _.a.createElement("div",{className:"Comments-container",ref:function(t){return e.domNode=t}},_.a.createElement(J,te({},d,w,{commentPattern:o,className:N()({"Comments--hidden":g&&"bottom"!==o}),order:E,status:C,onStatusChange:this.handleStatusChange,onOrderChange:this.handleOrderChange,needLoadCommentPermission:m,isAuthor:h})),g&&_.a.createElement(ee,te({},d,w,{commentPattern:o,commentId:g,onNavBack:this.showComments})))}}]),t}(P.Component),C.propTypes={type:k.a.string.isRequired,parent:k.a.object.isRequired,onOrderChange:k.a.func,onItemLike:k.a.func,isAuthor:k.a.bool,onMount:k.a.func},C.defaultProps={type:"answer"},C.contextTypes={currentUser:k.a.object,authRequired:k.a.func.isRequired},w=function(){var e=this;this.state={openedCommentId:null,status:"open",order:"normal"},this.like=function(t,n){var o=e.props,r=o.onItemLike,a=o.dispatch;r&&r(t,n),a(Object(j.j)(t))},this.collapse=function(t){var n=e.props,o=n.dispatch,r=n.parent;o(Object(j.g)(t,r.type,r.id))},this.dislike=function(t){return e.props.dispatch(Object(j.h)(t))},this.approve=function(t){var n=e.props,o=n.dispatch,r=n.parent,a=n.type;o(Object(j.b)(t,r.type||a,r.id))},this.handleStatusChange=function(t){e.setState({status:t})},this.handleOrderChange=function(t,n){e.props.onOrderChange&&e.props.onOrderChange(t,n),e.setState({order:t})}},E);t.default=Object(I.connect)()(oe)},1644:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function p(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var v,y,b,g,C,E,w,O=n(1),k=n.n(O),P=n(0),_=n.n(P),I=n(3),S=(n(86),n(38)),N=n(5),j=n(15),T=n(54),R=n(448),x=function(e,t,n){return n&&void 0!==t&&(e||!t)},A=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),L=20,D=60,M=(y=v=function(e){function t(){o(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.shouldSubmitIsDisabled=function(){var t=e.state,n=t.title,o=t.description;return!n||n.length>L||o.length>D},e.state={isPublic:!0,title:"",description:""},e.handleSubmit=e.handleSubmit.bind(e),e}return a(t,e),A(t,[{key:"handleSubmit",value:function(e){e.preventDefault();var t=this.state,n=t.isPublic,o=t.title,r=t.description;if(o){var a=this.props,i=a.onSubmit,s=a.onBack,c=a.authRequired,l=a.isActive,u={title:o,description:r,isPublic:n};x(n,l,c)?c(i)(u):(i(u),s())}}},{key:"render",value:function(){var e=this,t=this.state,n=t.title,o=t.description,r=t.isPublic,a=this.props.onBack,i=this.shouldSubmitIsDisabled();return _.a.createElement("form",{className:"Favlists-content",onSubmit:this.handleSubmit},_.a.createElement("div",{className:"Favlists-addItems"},_.a.createElement("div",{className:"Favlists-addItem"},_.a.createElement(T.a,{className:"Favlists-titleInput",placeholder:"收藏标题",onChange:function(t){var n=t.target.value;e.setState({title:n})}}),_.a.createElement("div",{className:"Favlists-inputTips"},_.a.createElement(R.a,{name:"收藏标题",current:n?n.length:0,max:L}))),_.a.createElement("div",{className:"Favlists-addItem"},_.a.createElement(T.a,{multiline:!0,className:"Favlists-descritionInput",placeholder:"收藏描述（可选）",onChange:function(t){var n=t.target.value;e.setState({description:n})},rows:5}),_.a.createElement("div",{className:"Favlists-inputTips"},_.a.createElement(R.a,{name:"收藏描述",current:o?o.length:0,max:D}))),_.a.createElement("div",{className:"Favlists-addItem"},_.a.createElement("label",{className:"Favlists-privacyOption"},_.a.createElement("input",{className:"Favlists-privacyOptionRadio",name:"isPublic",type:"radio",value:"true",checked:r,onChange:function(){return e.setState({isPublic:!0})}}),_.a.createElement("span",null,"公开"),_.a.createElement("span",{className:"Favlists-privacyOptionTips"},"有其他人关注此收藏夹时不可设置为私密")),_.a.createElement("label",{className:"Favlists-privacyOption"},_.a.createElement("input",{className:"Favlists-privacyOptionRadio",name:"isPublic",type:"radio",value:"false",checked:!r,onChange:function(){return e.setState({isPublic:!1})}}),_.a.createElement("span",null,"私密"),_.a.createElement("span",{className:"Favlists-privacyOptionTips"},"只有你自己可以查看这个收藏夹")))),_.a.createElement(S.a,{direction:"horizontal",className:""},a&&_.a.createElement(I.c,{onClick:a},"返回"),_.a.createElement(I.c,{color:"blue",preset:"primary",type:"submit",disabled:i},"确认创建")))}}]),t}(P.Component),v.propTypes={onSubmit:k.a.func.isRequired,onBack:k.a.func,authRequired:k.a.func},y),F=M,B=n(79),V=n(460),q=n(7),U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},z=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),W=function(e){function t(){var e,n,o,r;i(this,t);for(var a=arguments.length,c=Array(a),l=0;l<a;l++)c[l]=arguments[l];return n=o=s(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),o.handleChange=function(){var e=o.props;(0,e.onChange)(e.id,o.props.checked)},r=n,s(o,r)}return c(t,e),z(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.zaEnabled,n=e.id;t&&N.a.setModule(this,{module:"CollectionItem"},{card:{card_type:"Content",content:{type:"Collection",token:String(n)}}})}},{key:"render",value:function(){var e=this.props,t=e.answerCount,n=e.title,o=e.isPublic,r=e.checked,a=void 0!==r&&r,i=a?{preset:"primary",color:"grey",children:"已收藏"}:{color:"blue",children:"收藏"};return _.a.createElement("div",{className:"Favlists-item"},_.a.createElement("div",{className:"Favlists-itemInner"},_.a.createElement("div",{className:"Favlists-itemName"},_.a.createElement("span",{className:"Favlists-itemNameText"},n),!1===o&&_.a.createElement("span",{className:"Favlists-itemIcon"},_.a.createElement(q._1,{size:16}))),_.a.createElement("div",{className:"Favlists-itemContent"},t," 条内容")),_.a.createElement(I.c,U({},i,{className:"Favlists-updateButton",onClick:this.handleChange})))}}]),t}(P.Component),G=W,H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},K=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Y=(g=b=function(e){function t(){var e,n,o,r;l(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.items={},o.handleFavlistItemChange=function(e,t){N.a.trackEvent(o.items[e],{action:t?"UnCollect":"Collect",element:"Button",is_intent:!1}),o.props.onUpdate(e,t)},r=n,u(o,r)}return m(t,e),K(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.relations,o=t.items,r=t.isFetching,a=t.isDrained,i=t.onAdd,s=t.onLoad;return _.a.createElement("div",{className:"Favlists-content"},_.a.createElement(B.b,{isLocal:!0,isLoading:r,isDrained:a,onLoad:s,placeholder:_.a.createElement(V.a,{title:!0}),getContainer:function(e){return e},className:"Favlists-items"},o.map(function(t){return _.a.createElement(G,H({key:t.id,onChange:e.handleFavlistItemChange,checked:n[t.id]},t,{ref:function(n){e.items[t.id]=n}}))})),!o.length&&r||_.a.createElement("div",{className:"Favlists-actions"},_.a.createElement(I.c,{className:"Favlists-addButton",onClick:i,preset:"primary",color:"blue"},"创建收藏夹")))}}]),t}(P.Component),b.propTypes={isFecthing:k.a.bool,relations:k.a.object,onUpdate:k.a.func.isRequired,onAdd:k.a.func.isRequired,onLoad:k.a.func.isRequired,items:k.a.array.isRequired,isDrained:k.a.bool,authRequired:k.a.func},g),Q=Y,J=n(1246),Z=n(1247),$=(n(1313),n(1314),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),X=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),ee={list:{title:"添加收藏",tips:function(e){return e?"请选择你想添加的收藏夹":"你可以创建多个收藏夹，将答案分类收藏"}},add:{title:"创建新收藏夹"}},te=(E=C=function(e){function t(){var e,n,o,r;d(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=f(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),w.call(o),r=n,f(o,r)}return h(t,e),X(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.shown,o=t.items,r=t.id,a=t.type,i=t.onFetchRelations,s=e.items,c=e.relations;if(i&&(s.length!==o.length&&e.shown||s.length&&!n&&e.shown)){var l=(c?s.filter(function(e){return!{}.hasOwnProperty.call(c,e.id)}):s).map(function(e){return e.id});l.length&&i(r,a,l)}s.length>o.length&&this.setState({status:"list"})}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.id,o=t.type,r=t.shown,a=t.zaEnabled;r&&!e.shown&&this.container&&a&&N.a.setModule(this.container,{module:"CollectionDialogue"},{card:{card_type:"Content",content:{type:Object(Z.a)(o),token:String(n)}}})}},{key:"render",value:function(){var e=this,t=this.state.status,n=ee[t],o=n.title,r=n.tips,a=this.props,i=a.shown,s=a.defaultStatus,c=a.relations,l=a.onFavlistAdd,u=a.onLoad,m=a.isFetching,d=a.isDrained,f=a.items,h=a.zaEnabled,v=a.authRequired,y=a.isUserActive,b=p(a,["shown","defaultStatus","relations","onFavlistAdd","onLoad","isFetching","isDrained","items","zaEnabled","authRequired","isUserActive"]),g=!(d&&!f.length),C=Object(J.a)(b,Object.keys(j.b.propTypes)),E=C.selectedProps,w=void 0;return w="list"===t?g?_.a.createElement(Q,{ref:function(t){e.container=t},items:f,isFetching:m,isDrained:d,relations:c,onAdd:this.handleAdd,onUpdate:this.handleUpdate,onLoad:u,zaEnabled:h}):_.a.createElement(S.a,null,_.a.createElement(I.c,{preset:"primary",color:"blue",onClick:this.handleAdd},"创建收藏夹"),_.a.createElement(I.c,{onClick:this.handleCloseModal},"取消")):_.a.createElement(F,{onSubmit:l,isActive:y,onBack:"add"===s?this.handleCloseModal:this.handleBack,authRequired:v}),_.a.createElement(j.b,$({},E,{onClose:this.handleCloseModal,title:o,subtitle:r&&r(g),buttonGroupOnly:!g,className:"FavlistsModal",size:"large"}),i&&w)}}]),t}(P.Component),C.propTypes={id:k.a.oneOfType([k.a.string,k.a.number]),type:k.a.oneOf(["answer","article","pin"]),relations:k.a.object,onUpdateFav:k.a.func.isRequired,onFavlistAdd:k.a.func.isRequired,onFetchRelations:k.a.func,onClose:k.a.func.isRequired,shown:k.a.bool,zaEnabled:k.a.bool,authRequired:k.a.func,isUserActive:k.a.number},C.defaultProps={defaultStatus:"list",relations:{},authRequired:function(e){return e}},w=function(){var e=this;this.state={status:this.props.defaultStatus},this.handleCloseModal=function(){e.props.onClose&&e.props.onClose(),e.setState({status:"list"})},this.handleUpdate=function(t,n){var o=e.props,r=o.onUpdateFav,a=o.id,i=o.type,s=o.items,c=o.authRequired,l=o.isUserActive,u=s.find(function(e){return e.id===t})||{},m=[t,a,i,u.isPublic];return!n&&x(u.isPublic,l,c)?c(r).apply(void 0,m):r.apply(void 0,m)},this.handleAdd=function(){return e.setState({status:"add"})},this.handleBack=function(){return e.setState({status:"list"})}},E),ne=te;n.d(t,"FavlistsModal",function(){return ne})},1646:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function h(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function O(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function k(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function S(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var N,j,T,R,x,A,L,D,M,F,B,V,q=n(1),U=n.n(q),z=n(0),W=n.n(z),G=n(5),H=n(15),K=[{id:0,text:"举报",childIds:[1,2,3,4,5,21,7,8,9]},{id:1,text:"低质问题",types:["question"],childIds:[23,33,34,15,35,27,22]},{id:2,text:"垃圾广告信息",reason:"spam",copywriter:{title:"举报说明",placeholder:"举报详细说明（选填）",isRequired:!1},disabled:!0},{id:3,text:"不友善行为",types:["answer","comment","article","pin","book_review","favlist"],childIds:[40,41]},{id:4,text:"有害信息",childIds:[19,30,39,26,18,28]},{id:5,text:"涉嫌侵权",childIds:[20,29,12],types:["question","answer","comment","article","pin","book_review"],reason:"infringement",disabled:!0},{id:6,types:[]},{id:7,text:"其他",reason:"old",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:8,reason:"direction",shouldShow:function(e){return e.isColumnArticle}},{id:9,reason:"tipjar",shouldShow:function(e){return e.isTipjarEnabled}},{id:10,reason:"mention"},{id:11,reason:"privacy",disabled:!0},{id:12,reason:"enterprise",disabled:!0},{id:13,reason:"copy",copywriter:{title:"原文链接或出处",placeholder:"填写原文链接或描述内容出处（必填）"},disabled:!0},{id:14,reason:"defamation",disabled:!0},{id:15,reason:"abuse"},{id:16,reason:"intention"},{id:17,reason:"spam"},{id:18,reason:"illegality",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:19,reason:"politics"},{id:20,reason:"repost",copywriter:{title:"举报说明",placeholder:"原文链接或补充说明（必填）"},types:["answer","article","pin","book_review"],disabled:!0},{id:21,reason:"temptation",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0,types:["answer","comment","article"]},{id:22,reason:"personal"},{id:23,reason:"ambiguity"},{id:24,reason:"worthless"},{id:25,reason:"rumour"},{id:26,reason:"suicide",types:["question","answer","article","pin","book_review","comment"]},{id:27,reason:"medicine"},{id:28,reason:"superstition"},{id:29,reason:"oneself",disabled:!0},{id:30,reason:"porn"},{id:31,reason:"pirate"},{id:32,reason:"invalid"},{id:33,reason:"subjective"},{id:34,reason:"rumour"},{id:35,reason:"provoke"},{id:36,reason:"edit"},{id:37,reason:"harassment"},{id:38,reason:"hatred"},{id:39,text:"不实信息",types:["answer","comment","article","pin","book_review"],childIds:[42,43,44,45]},{id:40,reason:"abuse",text:"骚扰、辱骂、歧视等"},{id:41,reason:"unfriendly",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:42,reason:"untruth_science",text:"科学类不实信息",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:43,reason:"untruth_rumor",text:"社会谣言类不实信息",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:44,reason:"untruth_fake_profile",text:"编造经历类不实信息",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:45,text:"诽谤等侵权信息",childIds:[20,29,12]}],Y=[{id:0,text:"举报",childIds:[1,2,3,4]},{id:1,text:"垃圾广告信息",reason:"spam"},{id:2,text:"不友善行为",reason:"unkind"},{id:3,text:"有害信息",reason:"imitation"},{id:4,text:"其他",reason:"old",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0}],Q=[{id:0,text:"举报",childIds:[1,2,3]},{id:1,reason:"abuse"},{id:2,reason:"harassment"},{id:3,reason:"spam"}],J=[{id:0,text:"举报",childIds:[1,4,6,7]},{id:1,text:"冒充我或他人",childIds:[8,9],reason:"fake",disabled:!0},{id:2,reason:"abuse",text:"发过辱骂我或他人的内容"},{id:3,reason:"illegality",text:"发过违反法律法规的内容"},{id:4,reason:"spam",text:"垃圾广告帐号"},{id:5,reason:"politics",text:"发过政治敏感内容"},{id:6,reason:"profile",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:7,reason:"old",text:"其他",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:8,text:"冒充我",reason:"oneself",disabled:!0},{id:9,reason:"impersonate",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},text:"冒充他人",disabled:!0}],Z=n(2),$=n.n(Z),X=n(3),ee=n(38),te=n(35),ne=n(444),oe=n(7),re=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),ae=(j=N=function(e){function t(){o(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.handleClick=e.handleClick.bind(e),e}return a(t,e),re(t,[{key:"handleClick",value:function(){var e=this.props,t=e.id,n=e.reason,o=e.disabled,r=e.onSubMenuEnter,a=e.onItemSelect;n&&!o?a(t):r(t)}},{key:"render",value:function(){var e=this.props,t=e.reason,n=e.text,o=e.disabled,r=e.isSelected,a=e.id,i=n||ne.b[t];return Boolean(t&&!o)?W.a.createElement("label",{className:"ReportMenu-item",htmlFor:t},W.a.createElement("div",{className:"ReportMenu-itemValue needsclick"},i),W.a.createElement("input",{className:"ReportMenu-itemCheck",type:"radio",name:"report",value:a,id:t,checked:r,onChange:this.handleClick}),W.a.createElement(oe.o,{size:18,className:"ReportMenu-itemCheckIcon",name:"checkRound"})):W.a.createElement("button",{className:"ReportMenu-item",onClick:this.handleClick},W.a.createElement("span",{className:"ReportMenu-itemValue"},i),W.a.createElement(oe.f,{size:18}))}}]),t}(z.Component),N.propTypes={id:U.a.number.isRequired,reason:U.a.string,text:U.a.string,disabled:U.a.bool,isSelected:U.a.bool,onSubMenuEnter:U.a.func.isRequired,onItemSelect:U.a.func.isRequired},j),ie=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),se=(R=T=function(e){function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,e),ie(t,[{key:"render",value:function(){var e=this.props,t=e.reason,n=e.isMobile;switch(t){case"oneself":return W.a.createElement("div",{className:"ReportMenu-inner"},W.a.createElement("div",{className:"ReportMenu-paragraph"},"当您发现知乎上有关于您个人的侵权内容时，您可通过此渠道向知乎提交举报诉求。"),W.a.createElement("div",{className:"ReportMenu-paragraph"},"根据",W.a.createElement("a",{className:"ReportMenu-link",href:"https://www.zhihu.com/terms#sec-report",target:"_blank",rel:"noopener noreferrer"},"知乎侵权举报规范"),"，您需要向我们提交您的个人信息，其中包括身份证明。如您确认已准备齐全，",n?W.a.createElement("span",null,W.a.createElement("strong",null,"请到桌面版网页进行诉求提交。")):W.a.createElement("span",null,"可点击下方按钮进入诉求提交页。")));case"privacy":return W.a.createElement("div",{className:"ReportMenu-inner"},W.a.createElement("div",{className:"ReportMenu-paragraph"},"您好，当您发现知乎上有泄漏您隐私的内容时，您可向知乎进行举报。 请您把以下内容通过邮件发送到 ",W.a.createElement("a",{className:"ReportMenu-link",href:"mailto:i@zhihu.com"},"i@zhihu.com")," 邮箱，我们会尽快处理。"),W.a.createElement("ul",{className:"ReportMenu-paragraph"},W.a.createElement("li",null,"1. 您认为哪些内容泄露了您的隐私？（请在邮件中列出您举报的内容、链接地址，并给出简短的说明）"),W.a.createElement("li",null,"2. 您是谁？（身份证明材料，可以是身份证或护照等证件）")),W.a.createElement("div",{className:"ReportMenu-paragraph ReportMenu-paragraph--light"},"邮件格式请参考",W.a.createElement("a",{className:"ReportMenu-link--light",href:"https://www.zhihu.com/terms#sec-report",target:"_blank",rel:"noopener noreferrer"},"这里"),"；"));case"enterprise":return W.a.createElement("div",{className:"ReportMenu-inner"},W.a.createElement("div",{className:"ReportMenu-paragraph"},"当您发现知乎上有关于您企业的侵权等内容时，知乎建议您先尝试与作者沟通解决问题。 如果您无法联系到作者，您也可通过此渠道向知乎提出诉求。"),W.a.createElement("div",{className:"ReportMenu-paragraph"},"根据",W.a.createElement("a",{className:"ReportMenu-link",href:"https://www.zhihu.com/terms#sec-report",target:"_blank",rel:"noopener noreferrer"},"知乎侵权举报规范"),"，您需要向我们提交您的个人信息，其中包括身份证明。如您确认已准备齐全，",n?W.a.createElement("span",null,W.a.createElement("strong",null,"请到桌面版网页进行诉求提交。")):W.a.createElement("span",null,"可点击下方按钮进入诉求提交页。")));case"defamation":return W.a.createElement("div",{className:"ReportMenu-inner"},W.a.createElement("div",{className:"ReportMenu-paragraph"},"您好，当您发现知乎上有诽谤您的内容时，您可以向知乎进行举报。 请您把以下内容通过邮件发送到",W.a.createElement("a",{className:"ReportMenu-link",href:"mailto:i@zhihu.com"}," ","i@zhihu.com"," "),"邮箱，我们会尽快处理。"),W.a.createElement("ul",{className:"ReportMenu-paragraph"},W.a.createElement("li",null,"1. 您举报的内容以及侵犯了您什么权益？（请在邮件中列出您举报的内容、链接地址，并给出简短的说明）"),W.a.createElement("li",null,"2. 您是谁？（身份证明材料，可以是身份证或护照等证件）")),W.a.createElement("div",{className:"ReportMenu-paragraph ReportMenu-paragraph--light"},"邮件格式请参考 ",W.a.createElement("a",{className:"ReportMenu-link--light",href:"https://www.zhihu.com/terms#sec-report",target:"_blank",rel:"noopener noreferrer"},"这里")," ；"));default:return null}}}]),t}(z.Component),T.propTypes={reason:U.a.string.isRequired},R),ce=n(54),le=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),ue=(A=x=function(e){function t(){return l(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return m(t,e),le(t,[{key:"render",value:function(){var e=this.props,t=e.copywriter.placeholder,n=e.onDetailInput,o=e.errorText,r=e.checkCustomReasonContent;return W.a.createElement("div",{className:"ReportMenu-inner"},W.a.createElement(ce.a,{multiline:!0,grey:!0,rows:5,className:"ReportMenu-textarea",placeholder:t,onChange:function(e){return n(e.target.value)},onBlur:r}),W.a.createElement("div",{className:"ReportMenu-errorText"},o))}}]),t}(z.Component),x.propTypes={onDetailInput:U.a.func.isRequired,copywriter:U.a.object,errorText:U.a.string},A),me=(n(1582),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),pe=function(e){function t(){return p(this,t),d(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return f(t,e),me(t,[{key:"render",value:function(){var e=this.props,t=e.checked,n=e.onChange,o=e.name,r=e.text,a=e.desc,i=o||r;return W.a.createElement("div",null,W.a.createElement("label",{className:"ReportOption-check",htmlFor:i},W.a.createElement("input",{type:"checkbox",name:i,checked:t,onChange:n}),W.a.createElement("span",null,"同时",r)),a&&W.a.createElement("div",{className:"ReportOption-desc"},a))}}]),t}(z.Component),de=pe,fe=function(e){var t=/[\u4e00-\u9fa5a-zA-Z0-9]/;return e.length>150?{isLegal:!1,errorReason:ne.a.contentTooLong}:t.test(e)?{isLegal:!0,errorReason:""}:{isLegal:!1,errorReason:ne.a.contentIllegal}},he=(n(1583),function(){function e(e,t){var n=[],o=!0,r=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(o=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);o=!0);}catch(e){r=!0,a=e}finally{try{!o&&s.return&&s.return()}finally{if(r)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()),ve=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},ye=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),be=(D=L=function(e){function t(){var e,n,o,r;v(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=y(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={blockChecked:null,commentChecked:null,activeId:0,parentId:null,selectedId:null,errorText:"",isMobile:!1,isSubmiting:!1},o.menuItems={},o.handleItemSelect=function(e){var t=o.selectedId===e?null:e;o.setState({selectedId:t});var n=o.props,r=n.zaEnabled,a=n.type;t&&r&&G.a.trackEvent(o.menuItems[t],{action:"Select",element:"Menu"},{report:{id:e,type:a}})},o.handleSubMenuEnter=function(e){o.setState(function(t){var n=t.activeId;return{activeId:e,parentId:n,selectedId:null}});var t=o.props,n=t.zaEnabled,r=t.type;n&&G.a.trackEvent(o.menuItems[e],{action:"Expand",element:"Menu"},{report:{id:e,type:r}})},o.getCommentChecked=function(){var e=o.state,t=e.commentChecked,n=e.parentId,r=e.activeId;return"boolean"==typeof t?t:[2,3].includes(n||r)},o.handleDetailInput=function(e){o.setState({customReason:e,errorText:""})},o.handleBackClick=function(){var e=o.props.nodes,t=o.state.parentId,n=Object.keys(e).find(function(n){var o=e[n].childIds;return o&&o.includes(t)});o.setState({activeId:t,parentId:n&&Number(n),selectedId:null,hasWarning:!1,customReason:"",errorText:""});var r=o.props,a=r.zaEnabled,i=r.type;a&&G.a.trackEvent(o,{action:"Back",element:"Button"},{report:{id:o.state.activeId,type:i}})},o.handleSubmitAppeal=function(){var e="",t=o.state.activeId,n=o.props,r=n.type,a=n.urlToken,i=n.nodes;"enterprise"===i[t].reason||13===t?e="org":"oneself"!==i[t].reason&&37!==t||(e="people"),window.open("//www.zhihu.com/account/complaints/"+e+"/"+r+"/"+a)},o.handleSubmit=function(){var e=o.state,t=e.selectedId,n=e.customReason,r=e.activeId,a=e.parentId,i=o.getCommentChecked();if(o.isSubmitEnabled()&&o.checkCustomReasonContent()){var s=o.props,c=s.nodes,l=s.onSubmit,u=s.onDeleteComment,m=c[t||r],p=m.reason,d=m.id;o.setState({isSubmiting:!0});var f=l({reason:p,customReason:n});f&&f.then?f.then(o.submitEnd):o.submitEnd();var h=a||r,v=u&&[2,3].includes(h),y=o.props,b=y.zaEnabled,g=y.type;b&&G.a.trackEvent(o,ve({action:"Report",element:"Button"},v&&{id:3039,name:p}),ve({report:{id:d,type:g}},v&&{button:{text:i?"举报并删除":"仅举报"}}))}},o.submitEnd=function(e){o.setState({isSubmiting:!1});var t=o.state.blockChecked,n=o.props,r=n.onBlockUser,a=n.onDeleteComment,i=n.onEnd;Promise.all([t&&r&&r(),o.getCommentChecked()&&a&&a()].map(function(e){return Promise.resolve(e).catch(function(e){return e})})).then(function(t){var n=he(t,2),o=n[0],r=n[1];i({result:e,blockUserResult:o,commentDeleteResult:r})})},o.checkCustomReasonContent=function(){var e=o.state,t=e.activeId,n=e.customReason,r=o.props.nodes,a=r[t].copywriter;if((14===t||24===t||Boolean(a))&&n){var i=fe(n),s=i.isLegal,c=i.errorReason;if(!s)return o.setState({errorText:c}),!1}return!0},r=n,y(o,r)}return b(t,e),ye(t,[{key:"componentDidMount",value:function(){var e=Object(te.a)(navigator.userAgent);this.setState({isMobile:e.Mobile})}},{key:"componentWillUpdate",value:function(e,t){var n=this.state.activeId,o=t.activeId,r=this.props,a=r.nodes,i=r.onContentChange;if(o!==n){var s=a[o],c=s.reason,l=s.text,u=s.childIds,m=s.copywriter;i(l||ne.b[c],m&&m.title||(u?void 0:""))}}},{key:"isSubmitEnabled",value:function(){var e=this.state,t=e.selectedId,n=e.activeId,o=e.customReason,r=this.props.nodes;return t||(Boolean(r[n].copywriter)||14===n||24===n)&&(!1===r[n].copywriter.isRequired||o)}},{key:"render",value:function(){var e=this,t=this.props,n=t.nodes,o=t.options,r=h(t,["nodes","options"]),a=this.state,i=a.activeId,s=a.parentId,c=a.selectedId,l=a.errorText,u=a.isMobile,m=n[i],p=m.reason,d=m.childIds,f=m.copywriter,v=Boolean(d),y=14===i||24===i||Boolean(f),b=v&&W.a.createElement("div",{className:"ReportMenu-inner ReportMenu-options"},d.map(function(e){return n[e]}).filter(function(e){return e&&(!e.shouldShow||e.shouldShow(r))}).map(function(t){return W.a.createElement(ae,ve({ref:function(n){e.menuItems[t.id]=n},key:t.id},t,{isSelected:c===t.id,onSubMenuEnter:e.handleSubMenuEnter,onItemSelect:e.handleItemSelect}))})," ")||y&&W.a.createElement(ue,{onDetailInput:this.handleDetailInput,copywriter:f,errorText:l,checkCustomReasonContent:this.checkCustomReasonContent})||W.a.createElement(se,{isMobile:u,reason:p}),g=v&&r.talkerToken&&W.a.createElement(de,{checked:this.state.blockChecked,text:"将此人屏蔽",onChange:function(t){return e.setState({blockChecked:t.target.checked})}}),C=s||i,E=r.onDeleteComment&&[2,3].includes(C)&&W.a.createElement(de,{checked:this.getCommentChecked(),desc:Boolean(C)&&"社区鼓励举报"+n[C].text+"，同时可以直接删除该评论，删除操作并不影响对违规内容和违规用户的处理。",onChange:function(t){return e.setState({commentChecked:t.target.checked})},text:"删除该评论"}),w=this.props.isSubmiting;return W.a.createElement("div",{className:$()("ReportMenu",{"ReportMenu-mobile":u})},b,(g||E)&&W.a.createElement("div",null,g,E,o),W.a.createElement(ee.a,{direction:"horizontal"},"number"==typeof s&&W.a.createElement(X.c,{onClick:this.handleBackClick}," 返回 "),v||y?W.a.createElement(X.c,{className:"ReportMenu-button",disabled:w||!this.isSubmitEnabled(),onClick:this.handleSubmit,color:"blue",preset:"primary"},"举报"):!u&&W.a.createElement(X.c,{onClick:this.handleSubmitAppeal,preset:"primary",color:"blue"},"进入诉求提交页面")))}}]),t}(z.Component),L.propTypes={nodes:U.a.object.isRequired,onContentChange:U.a.func.isRequired,onSubmit:U.a.func.isRequired,onEnd:U.a.func,onBlockUser:U.a.func,onDeleteComment:U.a.func,isColumnArticle:U.a.bool,isTipjarEnabled:U.a.bool},D),ge=be,Ce=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Ee=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),we=(F=M=function(e){function t(){var e,n,o,r;E(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=w(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.filterNodes=function(e,t,n){var o=e.filter(function(e){return-1!=["infringement","repost","oneself","enterprise","fake"].indexOf(e.reason)||0===e.id||("question"!==t||-1==["closed","suggested","evaluated","locked"].indexOf(n)||0===e.id)&&("member"!==t||-1==["ban","hang"].indexOf(n)||"profile"===e.reason)});return 1===o.length&&0===o[0].id&&(o=[]),o},r=n,w(o,r)}return O(t,e),Ee(t,[{key:"render",value:function(){var e=this.props,t=e.type,n=e.status,o=C(e,["type","status"]),r=void 0;return r="message"===t?Q:"member"===t?J:"favlist"===t?Y:K.filter(function(e){return!e.types||e.types.includes(t)}),r=this.filterNodes(r,t,n),W.a.createElement(ge,Ce({nodes:r.reduce(function(e,t){return Ce({},e,g({},t.id,t))},{})},o,{type:t}))}}]),t}(z.Component),M.propTypes={type:U.a.string.isRequired},F),Oe=n(1246),ke=n(1247),Pe=n(56),_e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Ie=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Se="请选择举报理由",Ne="举报",je=(V=B=function(e){function t(){var e,n,o,r;_(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=I(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={title:void 0!==o.props.title?o.props.title:Ne,subtitle:void 0!==o.props.subtitle?o.props.subtitle:Se},o.handleSubmit=function(e){var t=e.reason,n=e.customReason,r=o.props,a=r.urlToken,i=r.type;return o.props.doReport(a,i,t,n)},o.handleContentChange=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Se;o.setState({title:e,subtitle:t})},o.handleClose=function(){o.props.zaEnabled&&G.a.trackEvent(o.container,{action:"Ok"},{button:{text:"知道了"}}),o.props.onClose()},r=n,I(o,r)}return S(t,e),Ie(t,[{key:"componentDidUpdate",value:function(e){if(!e.shown&&this.props.shown){var t=this.props,n=t.type,o=t.id;G.a.setModule(this.container,{module:"ReportDialog"},{card:{card_type:"Content",content:P({type:Object(ke.a)(n)},"comment"===n?"id":"token",String(o))}})}}},{key:"render",value:function(){var e=this,t=this.props,n=t.shown,o=t.onClose,r=k(t,["shown","onClose"]),a=this.state,i=a.title,s=a.subtitle,c=Object(Oe.a)(r,Object.keys(H.b.propTypes)),l=c.selectedProps,u=c.dropedProps;return W.a.createElement(H.b,_e({title:i,subtitle:s,onClose:this.handleClose,className:"ReportModal"},l),n&&W.a.createElement(we,_e({ref:function(t){e.container=t},onSubmit:this.handleSubmit,onEnd:o,onContentChange:this.handleContentChange},u)))}}]),t}(z.Component),B.propTypes={onClose:U.a.func.isRequired,type:U.a.oneOf(Pe.a).isRequired,shown:U.a.bool.isRequired,isColumnArticle:U.a.bool,isTipjarEnabled:U.a.bool,onBlockUser:U.a.func,onDeleteComment:U.a.func,doReport:U.a.func.isRequired,zaEnabled:U.a.bool},B.defaultTypes={zaEnabled:!1},V);n.d(t,"ReportModal",function(){return je})},1647:function(e,t,n){"use strict";function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(){return function(e){e({API:{types:ht.GET_COMMENT_WITH_PIC_PERMISSION,method:"GET",endpoint:"/user-permission"}})}}function a(){return function(e){e({API:{types:ht.GET_STICKERS,method:"GET",endpoint:"/stickers"}})}}function i(e){return function(t,n){var o=n(),r=o.comments.notificationsComments,a=r||{},i=a[e]||{},s=i.next,c=i.isDrained,l=i.isFetching,u="notifications/v2/timeline/"+e;if(!c&&s&&(u=s),!l)return t({isCommentV2:!0,id:e,API:{types:ht.LOAD_NOTI_COMMENTS,endpoint:u},schema:ct.a.NOTIFICATION_COMMENT_ARRAY,NOTIFICATION:{key:ut.b,failure:function(e){return(!e||403!==e.code)&&ut.a}}})}}function s(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.order,a=void 0===r?"normal":r,i=n.isPrevious,s=void 0!==i&&i,c=n.byComment,l=n.status,u=void 0===l?"open":l,m=n.commentPattern,p=n.current,d=n.patternLimit,f=void 0===d?20:d,h=arguments[3];return function(n,r){var i=r(),l=i.comments,d=l.pagination,v=ht.GET;"reviewing"===u&&(d=l.reviewing,v=ht.GET_REVIEWING),"collapsed"===u&&(d=l.collapsed,v=ht.GET_COLLAPSED),"reverse"===a&&"open"===u&&(d=l.reverse,v=ht.GET_REVERSE);var y=d[e+"_"+t]||{},b=y.next,g=y.previous,C=y.ids,E=void 0===C?[]:C,w=E.length&&(s?g:b),O=0,k=lt.a;return"bottom"!==m||h||(O=(p-1)*f,k=f,w=!1),n({parentId:t,isCommentV2:!0,parentType:e,isPrevious:s,API:pt({types:v},w?{endpoint:w}:{endpoint:(ft[e]||e)+"s/"+t+"/"+("reviewing"===u||c||"reverse"===a||h?"comments":"root_comments"),query:pt({include:"data[*]."+dt,order:a,limit:k},"open"===u&&c?{byComment:c}:{offset:O,status:u})}),schema:ct.a.COMMENT_ARRAY_V2,UPDATE:{failure:function(n){return n&&n.res&&403===n.res.status?o({},e+"s",o({},t,{adminClosedComment:!0})):{}}},NOTIFICATION:{key:ut.b,failure:function(e){return(!e||403!==e.code)&&ut.a}}})}}function c(e){var t=e.parentType,n=e.parentId,r=e.content,a=e.replyTo,i=e.conversationId,s=e.rootCommentId,c=e.isConversation,l=e.replyType,u=e.isAnchorComments,m=e.notificationId;return function(e,p){var d=a&&a.id||void 0,f=p().entities.comments,h=t+"s",v=(p().entities[h]||{})[n]||{},y=v.commentCount,b=ft[t]||t,g="评论发布成功！";return"commercial"===v.questionType&&"censor"===v.commentPermission&&(g="评论已提交，由品牌筛选后公开"),e({notificationId:m,parentType:t,isCommentV2:!0,parentId:n,id:i,rootCommentId:s,comments:f,isConversation:c,replyType:l,isAnchorComments:u,API:{types:ht.ADD,endpoint:b+"s/"+n+"/comments",query:{include:dt},method:"POST",body:Object(st.decamelizeKeys)({content:r,replyToId:d})},schema:ct.a.COMMENT,UPDATE:{request:o({},h,o({},n,{commentCount:y+1})),failure:o({},h,o({},n,{commentCount:y}))},NOTIFICATION:{key:ut.b,success:g,failure:"评论发布失败。"},replyToId:d,replyTo:a})}}function l(e){return function(t,n){var r,a,i=n(),s=i.entities.comments,c=s[e]||s[e+"_featured"],l=c.voteCount,u=c.voting,m=c.disliked;return t({id:e,isCommentV2:!0,API:{types:ht.UPDATE_LIKE,endpoint:"comments/"+e+"/actions/like",method:u?"DELETE":"POST",fetchOptions:{zsSignature:!0}},UPDATE:{request:{comments:(r={},o(r,e,{voteCount:l+(u?-1:1),voting:!u,disliked:!!u&&m}),o(r,e+"_featured",{voteCount:l+(u?-1:1),voting:!u,disliked:!!u&&m}),r)},success:function(t){var n;return{comments:(n={},o(n,e,t),o(n,e+"_featured",t),n)}},failure:{comments:(a={},o(a,e,c),o(a,e+"_featured",{voteCount:l,disliked:m}),a)}},NOTIFICATION:{key:ut.b,failure:ut.a}})}}function u(e){return function(t,n){var r,a,i=n(),s=i.entities.comments,c=s[e]||s[e+"_featured"],l=c.voting,u=c.voteCount,m=c.disliked,p=!m;return t({id:e,isCommentV2:!0,API:{types:ht.UPDATE_DISLIKE,endpoint:"comments/"+e+"/actions/dislike",method:m?"DELETE":"POST",fetchOptions:{zsSignature:!0}},UPDATE:{request:{comments:(r={},o(r,e,{disliked:p,voting:!!m&&l,voteCount:p&&l?u-1:u}),o(r,e+"_featured",{disliked:p,voting:!!m&&l,voteCount:p&&l?u-1:u}),r)},failure:{comments:(a={},o(a,e,c),o(a,e+"_featured",{disliked:m,voting:l,voteCount:u}),a)}},NOTIFICATION:{key:ut.b,failure:ut.a}})}}function m(e){return{API:{types:ht.DELETE,endpoint:"comments/"+e,method:"delete"}}}function p(e,t){var n=t.id;return e.entities.comments[n]}function d(e,t,n){return function(r,a){var i=a(),s=m(e),c={UPDATE:{request:{},failure:{}}},l=p(i,{id:e});l&&(c.UPDATE.request.comments=o({},e,{isDelete:!0}),c.UPDATE.failure.comments=o({},e,l));var u=t+"s",d=i.entities[u]||{}||[n],f=!!l&&l.reviewing;if(d&&!f){var h=d[n]?d[n].commentCount-1:0;c.UPDATE.request[u]=o({},n,{commentCount:h}),c.UPDATE.failure[u]=o({},n,d)}return r(pt({id:e,collapsed:l&&l.collapsed,isCommentV2:!0,reviewing:f,parentType:t,parentId:n},s,c,{NOTIFICATION:{key:ut.b,failure:ut.a}}))}}function f(e){var t=e.id,n=e.isAnchorComments,o=e.isLoadRest;return function(e,r){var a=r(),i=a.comments.conversation,s=a.entities.comments,c=void 0;if(i[t]&&i[t].newIds.length){var l=i[t],u=l.newIds,m=l.next,p=l.isFetching;if(!u.length||p)return;c=m}else c=n?"comments/"+t+"/anchor_comments":"comments/"+t+"/child_comments";return e({id:t,isLoadRest:o,comments:s,isCommentV2:!0,API:{types:ht.GET_CONVERSATION,endpoint:c,query:{include:"$[*].author,reply_to_author,content,vote_count"}},schema:ct.a.COMMENT_ARRAY_V2,NOTIFICATION:{key:ut.b,failure:ut.a}})}}function h(e){var t=e.nextUrl,n=e.conversationId;return function(e,o){var r=o().comments.conversationMore,a=r[n]||{},i=a.isFetching,s=a.next,c=a.isDrained;if(!i&&!c)return e({id:n,isCommentV2:!0,API:{types:ht.GET_CONVERSATION_MORE,endpoint:s||t},schema:ct.a.COMMENT_ARRAY,NOTIFICATION:{key:ut.b,failure:ut.a}})}}function v(e){var t=e.id,n=e.parentId,r=e.commentId,a=e.parentType,i=e.notificationId;return function(e,s){var c=s(),l=c.entities.comments,u=l[r],m=u.featured,p=u.collapsed,d=u.id,f=null;return f=m?l[d]?l[d]:o({},d,pt({},u,{featured:!m,collapsed:!!m&&p})):o({},d+"_featured",pt({},u,{childComments:[],childCommentCount:0,featured:!m,collapsed:!!m&&p})),e({id:t,commentId:d,isCommentV2:!0,parentId:n,parentType:a,expect:!m,notificationId:i,API:{types:ht.UPDATE_FEATURED,endpoint:"comments/"+d+"/actions/feature",method:m?"delete":"post"},UPDATE:{request:{comments:f},failure:{comments:o({},d,u)}},NOTIFICATION:{key:ut.b,failure:ut.a,endpoint:"comments/"+t+"/actions/feature",method:m?"delete":"post"}})}}function y(e,t,n){return function(r,a){var i=a(),s=i.entities,c=s.comments[e],l=c.collapsed,u=c.featured,m=!l;return r({id:e,isCommentV2:!0,expect:m,parentType:t,parentId:n,API:{types:ht.UPDATE_COLLAPSED,endpoint:"comments/"+e+"/actions/collapse",method:m?"post":"delete"},UPDATE:{request:{comments:o({},e,{collapsed:m,featured:!m&&u})},failure:{comments:o({},e,c)}},NOTIFICATION:{key:ut.b,failure:ut.a}})}}function b(e,t,n){return function(r,a){var i=a(),s=i.entities,c=s.comments[e],l=t+"s",u=s[l][n]||{commentCount:0};return r({id:e,isCommentV2:!0,parentId:n,parentType:t,API:{types:ht.APPROVE,endpoint:"comments/"+e+"/actions/approve",method:"PUT"},UPDATE:{request:o({comments:o({},e,{status:"open",isDelete:!0})},l,o({},n,{commentCount:u.commentCount+1})),failure:o({comments:o({},e,c)},l,o({},n,u))}})}}function g(e,t,n){return function(r,a){var i=a(),s=i.entities,c=s.comments[e],l=t+"s",u=s[l][n]||{commentCount:0};return r({id:e,isCommentV2:!0,parentId:n,parentType:t,API:{types:ht.REJECT,endpoint:"comments/"+e+"/actions/approve",method:"DELETE"},UPDATE:{request:o({comments:o({},e,{status:"open",isDelete:!0})},l,o({},n,{commentCount:u.commentCount-1})),failure:o({comments:o({},e,c)},l,o({},n,u))}})}}function C(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function w(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function O(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function P(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function I(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function N(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function j(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function T(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function x(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function L(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function D(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function F(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function B(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function V(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function U(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function z(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function W(e){var t=e.id,n=e.replyTo,o=e.isConversation;if(e.isNotification)return{type:"notification"};if(o)return{type:"conversation"};if(!n)return{type:"comment"};var r=n.featured,a=n.replyToAuthor,i=n.id;return t===i&&r&&!a?{type:"replyToFeatured"}:t===i&&r&&a?{type:"replyToSubFeatured"}:t!==i||a?t!==i&&a?{type:"replyToSubCommon"}:{type:"comment"}:{type:"replyToCommon"}}function G(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function K(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Y(e,t){var n=t.parent,o=t.parent,r=o.type,a=o.id,i=t.status,s=t.order,c=t.byComment,l=t.commentPattern,u=t.notificationId,m=e.entities,p=e.comments,d=e.comments,f=d.conversation,h=d.stickers,v=void 0===h?[]:h,y=d.commentWithPicPermission,b=d.notificationsComments,g=r+"_"+a,C=p.parent,E=m.comments[c],w=p.pagination;"reviewing"===i&&(w=p.reviewing);var O="reverse"===s&&"open"===i;O&&(w=p.reverse);var k=[],P=p.collapsed[g]||{};P&&P.ids&&P.ids.length>0&&(k=P.ids.map(function(e){return m.comments[e]})),u&&(w=b,g=u);var _=w[g]||{isPrevDrained:!1,isFetching:!1,isDrained:!1,ids:[]},I=_.isFetching,S=_.isPrevDrained,N=_.isDrained,j=_.ids,T=_.newIds,R=void 0===T?[]:T,x=_.totals,A="bottom"!==l?j:R,L=A.map(function(e){return m.comments[e]}),D=gt()(A,function(e){return String(e).includes("_featured")});return{currentUser:Object(Nn.c)(e),isFetching:I,isPrevDrained:S,isDrained:N,totals:u?L.length:x,collapsedInfo:P,collapsedComments:k,targetComment:E,conversation:f,entities:m,stickers:v,lastFeaturedIndex:D,comments:L,isReverseAndStatusOpen:O,commentWithPicPermission:y,ids:A,parent:jn({},n,C[g])}}function Q(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function J(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Z(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function $(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function X(e,t){var n=t.conversationId,o=t.isAnchorComments,r=e.entities.comments,a=e.comments,i=a.conversation,s=a.conversationMore,c=i[n]||{isFetching:!1,isDrained:!1,isPrevDrained:!1,ids:[]},l=c.isFetching,u=c.isDrained,m=c.isPrevDrained,p=c.ids,d=c.totals,f=c.topComments;f=void 0===f?{}:f;var h=f.paging,v=h||{},y=v.isEnd,b=s[n]||{isFetching:!1,isDrained:!1,ids:[]},g=b.isFetching,C=b.isDrained,E=b.ids,w=E.map(function(e){return r[e]}),O=p.map(function(e){return r[e]}),k=r[n+"_featured"]||r[n]||{},P=o?Dn()(E.length?[].concat(Q(O.slice(0,4)),Q(w),Q(O.slice(4))):O,"id"):[k].concat(Q(O)),_=h?[].concat(Q(O.slice(0,3)),Q(w)).length:-1;return{isFetching:l,isDrained:u,isPrevDrained:m,totals:d,comments:P,openComment:k,topCommentsPaging:h,isConversationMoreFetching:g,isConversationMoreDrained:y||C,offsetIndex:_}}function ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function te(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ne(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function oe(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function re(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ae(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ie(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function se(){return Array.from(document.querySelectorAll("script[src]")).map(function(e){return e.src})}function ce(){return Array.from(document.querySelectorAll('link[rel="stylesheet"]')).map(function(e){return e.href})}function le(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ue(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function me(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function pe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function de(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function fe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function he(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ve(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ye(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function be(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ge(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Ce(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Ee(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function we(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Oe(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ke(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var Pe,_e,Ie,Se,Ne,je,Te,Re,xe,Ae,Le,De,Me,Fe,Be,Ve,qe,Ue,ze,We,Ge,He,Ke,Ye,Qe,Je,Ze,$e,Xe,et=n(0),tt=n.n(et),nt=n(1),ot=n.n(nt),rt=n(4),at=n(2),it=n.n(at),st=n(9),ct=n(20),lt=n(27),ut=n(12),mt=n(6),pt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},dt="author,collapsed,reply_to_author,disliked,content,voting,vote_count,is_parent_author,is_author",ft={ebook:"book"},ht=pt({},Object(mt.a)("comment",["GET","GET_COLLAPSED","GET_REVERSE","GET_REVIEWING","GET_CONVERSATION","UPDATE_LIKE","UPDATE_DISLIKE","UPDATE_FEATURED","UPDATE_COLLAPSED","APPROVE","REJECT","DELETE","ADD","GET_MORE_REPLY_COMMENT","GET_CONVERSATION_MORE","GET_STICKERS","GET_COMMENT_WITH_PIC_PERMISSION","LOAD_NOTI_COMMENTS"]),Object(mt.b)("comment",["ORDER"])),vt=n(1244),yt=n(55),bt=n(1586),gt=n.n(bt),Ct=n(7),Et=n(79),wt=n(1245),Ot=n(29),kt=n(257),Pt=n(21),_t=n(23),It=n(5),St=n(88),Nt=n.n(St),jt=n(19),Tt=n(3),Rt=n(15),xt=(n(175),n(177)),At=n(448),Lt=n(82),Dt=n(443),Mt=n(467),Ft=n(174),Bt="zhihu::comment_local_key",Vt=5,qt=10,Ut=1e3,zt=980,Wt=function(){return""},Gt={error:"上传失败",success:"上传成功",uploadIng:"上传中",default:""},Ht=(n(1587),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),Kt=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Yt=(Pe=Object(rt.connect)(null,{showNotification:ut.f,uploadImage:Ft.b}))((Se=Ie=function(e){function t(){var e,n,o,r;C(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=E(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={uploadStatus:Gt.default},o.triggerClick=function(e){var t=o.props.handleInputActive;o.uploadInput.click(),t(!0),e.preventDefault()},o.onError=function(){var e=o.props,t=e.showNotification,n=e.resetUploadImg;t("图片上传失败","red"),n()},o.onSuccess=function(){o.setState({uploadStatus:Gt.default})},o.resetFileInput=function(){o.uploadInput.value=null},o.beforeUpload=function(e){var t=o.props.showNotification;return e?e.size>1024*qt*1024?(t("请上传小于 "+qt+"M 的图片。","red"),o.resetFileInput(),!1):(o.reactPopoverNode.open(),void o.setState({uploadStatus:Gt.uploadIng})):(o.resetFileInput(),!1)},o.uploadImage=function(e){var t=e.file,n=o.props,r=n.uploadImage,a=n.handleImages,i=n.updatePublishStatus;r(t).then(function(e){a([Ht({},e.payload,{url:e.payload.src})]),i(!1),o.resetFileInput()}).catch(function(){o.setState({uploadStatus:Gt.error}),a([])})},o.handleOnRef=function(e){var t=o.props.onRef;t&&t(e),o.reactPopoverNode=e},r=n,E(o,r)}return w(t,e),Kt(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.images,o=t.disableButton,r=t.resetUploadImg,a=this.state.uploadStatus,i=Boolean(n.length);return tt.a.createElement(et.Fragment,null,tt.a.createElement(Lt.a,{className:"ImagePopover",arrowed:!0,ref:this.handleOnRef,placement:"bottom",globalClose:!n.length,onClick:this.triggerClick,toggler:tt.a.createElement(Dt.a,{label:"插入图片",icon:Ct.a,disabled:o})},tt.a.createElement("div",{className:"ImagePopover-thumbnail"},i&&tt.a.createElement(et.Fragment,null,tt.a.createElement("img",{src:n[0].src}),tt.a.createElement("div",{className:"closeButton",onClick:r},tt.a.createElement(Ct.p,null))),a&&!i&&tt.a.createElement("p",{className:"ImagePopover-uplodaStatus"},a))),tt.a.createElement(Mt.a,{accept:"image/png,image/jpeg",onRef:function(t){e.uploadInput=t},beforeUpload:this.beforeUpload,customUpload:this.uploadImage,onSuccess:this.onSuccess,onError:this.onError}))}}]),t}(et.Component),Ie.propTypes={className:ot.a.string,disableButton:ot.a.bool},Ie.defaultProps={disableButton:!0},_e=Se))||_e,Qt=n(269),Jt=n(34),Zt=(n(1588),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),$t=(je=Ne=function(e){function t(){var e,n,o,r;O(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=k(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.handleOnRef=function(e){var t=o.props.onRef;t&&t(e)},r=n,k(o,r)}return P(t,e),Zt(t,[{key:"render",value:function(){var e=this.props,t=e.className,n=e.sticker,o=e.stickers,r=e.disableButton,a=e.handleStickerPopoverOpen,i=e.handleStickerPopoverClose,s=e.resetStickers,c=e.addSticker,l=e.handleEmotionClick;return tt.a.createElement(Lt.a,{className:t,arrowed:!0,ref:this.handleOnRef,globalClose:!n.length,preventCloseOnTarget:!0,onClick:l,onOpen:a,onClose:i,toggler:tt.a.createElement(Dt.a,{label:"插入表情",icon:Ct.z,disabled:r}),placement:"bottom"},Boolean(n.length)&&tt.a.createElement("li",{className:"StickerPopover StickerPopover-single"},tt.a.createElement("img",{src:Object(Jt.a)(n[0].url),alt:n[0].title}),tt.a.createElement("div",{className:"closeButton",onClick:s},tt.a.createElement(Ct.p,null))),!n.length&&tt.a.createElement("div",{className:"StickerPopover-stickersWrap"},tt.a.createElement("ul",{className:"StickerPopover-stickersList"},o.map(function(e){var t=e.url,n=e.title,o=e.id;return tt.a.createElement("li",{className:"StickerPopover",key:o,onClick:function(){c(e)}},tt.a.createElement(Qt.a,{width:48,height:48,url:Object(Jt.a)(t),alt:n}),tt.a.createElement("p",null,n))}))))}}]),t}(et.Component),Ne.propTypes={className:ot.a.string,disableButton:ot.a.bool},Ne.defaultProps={disableButton:!0},je),Xt=n(17),en=(n(85),n(1589),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),tn=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),nn=function(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["回复","",""],["回复","",""]),on=(Te=Object(rt.connect)(function(e){return{edition:Object(Xt.c)(e),referer:Object(Xt.g)(e),shouldOia:Object(Xt.h)(e),stickers:e.comments.stickers||[],commentWithPicPermission:e.comments.commentWithPicPermission||{}}},{showNotification:ut.f}),Object(_t.withRouter)(Re=Te((Ae=xe=function(e){function t(){var e,n,o,r;I(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=S(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={active:!1,disabled:!0,shown:!1,value:{toHTML:Wt},images:[],uploadIsFetchingNum:0,sticker:[],stickerIconActive:!1,toggleInputStyle:!1,commentTextLength:0},o.handleSubmit=o.context.authRequired(function(){var e=o.props,t=e.replyTo,n=e.onSubmit,r=e.onCancel,a=e.rootCommentId,i=e.isConversation,s=o.state,c=s.images,l=s.sticker,u=o.input.toHTML();if(u||c.length||l.length){u&&o.saveLocalComment();var m=u;if(c.length||l.length){var p=c[0]||l[0];m+='<a class="'+(c[0]&&(c[0].url.includes(".gif")?"comment_gif":"comment_img")||"comment_sticker")+"\" href='"+p.url+"' data-width='"+(p.dataRawwidth||"")+"' data-height='"+(p.dataRawheight||"")+"'>["+(p.title||"图片")+"]</a>"}var d=n(m,t,{rootCommentId:a,isConversation:i});d.then?d.then(function(){r&&r(),o.input?(o.input.reset(),o.resetImage(),o.setState({value:{toHTML:Wt}},function(){return o.saveLocalComment()})):o.saveLocalComment({toHTML:Wt})}):(r&&r(),o.input.reset()),It.a.trackEvent(o,{action:"Comment",element:"Button"})}},void 0,ut.b),o.handleCommentShow=o.context.authRequired(function(){o.setState({shown:!0}),o.hiddenInput.focus()}),o.handleCommentHide=function(){o.setState({shown:!1})},o.initLocalComment=function(){var e=o.props,t=e.type,n=e.id;if(t&&n){var r=jt.a.get(Bt)||[],a=t+"_"+n,i=r.find(function(e){return e.key===a}),s=i&&i.value;s&&o.setState({value:{toHTML:function(){return s}},disabled:!1})}},o.saveLocalComment=function(e){var t=o.props,n=t.type,r=t.id;if(n&&r){var a=e?e.toHTML():o.state.value.toHTML(),i=n+"_"+r,s=(jt.a.get(Bt)||[]).filter(function(e){return e.key!==i}),c=a?[].concat(_(s.slice(0,Vt-1)),[{key:i,value:a}]):s;jt.a.set(Bt,c)}},o.handleChange=function(e){var t=o.state,n=t.sticker,r=t.images;n.length||r.length?o.setState({value:e}):o.setState({value:e,disabled:e.isEmpty}),o.handleInputChange()},o.handleFocus=function(){o.setState({active:!0},o.handleInputChange)},o.handleBlur=function(){var e=o.state,t=e.sticker,n=e.images;t.length||n.length||(o.setState({active:!1}),o.handleInputChange())},o.handleMobileComment=function(){o.handleSubmit(),o.handleCommentHide()},o.handleEmotionClick=function(){var e=o.state.stickerIconActive;e&&o.setState({stickerIconActive:e},o.stickerPopover.close)},o.handleInputChange=function(){if(o.input){var e=Object(Pt.findDOMNode)(o.input);e.getBoundingClientRect().height>40?o.setState({toggleInputStyle:!0}):o.setState({toggleInputStyle:!1});var t=e.innerText.length;o.setState({commentTextLength:t}),o.imgUploadPopover&&o.imgUploadPopover.position(),o.stickerPopover&&o.stickerPopover.position()}},o.handleStickerPopoverOpen=function(){o.setState({active:!0,stickerIconActive:!0},o.stickerPopover.position),setTimeout(o.stickerPopover.position,400)},o.handleStickerPopoverClose=function(){o.setState({stickerIconActive:!1})},o.handleImages=function(e){o.setState({images:e},o.imgUploadPopover.position)},o.handleInputActive=function(e){o.setState({active:e})},o.updatePublishStatus=function(e){o.setState({disabled:e})},o.resetStickers=function(){var e=o.state.value,t=void 0===e.isEmpty||e.isEmpty;o.stickerPopover&&o.stickerPopover.close(),o.setState({sticker:[],disabled:t})},o.resetImage=function(){o.resetStickers(),o.resetUploadImg()},o.resetUploadImg=function(){var e=o.state.value,t=void 0===e.isEmpty||e.isEmpty;o.imgUploadPopover&&o.imgUploadPopover.close(),o.setState({images:[],disabled:t})},o.addSticker=function(e){o.setState({sticker:[e],disabled:!1},o.stickerPopover.position)},o.createImageOnRef=function(e){o.imgUploadPopover=e},o.createStickerOnRef=function(e){o.stickerPopover=e},o.renderInput=function(e){var t=e.placeholder,n=e.className,r=o.props,a=r.autoFocus,i=r.stickers,s=r.commentWithPicPermission.commentWithPic,c=o.state,l=c.images,u=c.sticker,m=c.stickerIconActive,p=c.toggleInputStyle,d=c.active,f=c.commentTextLength,h=Boolean(u.length)||Boolean(l.length);return tt.a.createElement("div",{className:it()("CommentEditorV2-inputWrap",{"CommentEditorV2-inputWrap--change":p,"CommentEditorV2-inputWrap--active":d}),onClick:function(e){e.nativeEvent.stopImmediatePropagation()}},tt.a.createElement(xt.a,{className:it()("CommentEditorV2-input",n),defaultValue:o.state.value.toHTML(),richtext:!0,large:!0,spread:!0,allowMention:!0,autoFocus:Boolean(void 0)||a,outputBlockType:"div",onRef:function(e){o.input=e},placeholder:t,onFocus:o.handleFocus,onChange:o.handleChange,onSubmit:o.handleSubmit,minRows:5}),tt.a.createElement("div",{className:it()("CommentEditorV2-inputUpload",{"CommentEditorV2-inputUpload--FlexEnd":p,"CommentEditorV2-inputUpload--SpaceBetween":p&&f>zt})},p&&f>zt&&tt.a.createElement(At.a,{className:"CommentEditorV2-MaxLength",current:f,max:Ut}),tt.a.createElement("div",{className:"CommentEditorV2-popoverWrap"},s&&tt.a.createElement(Yt,{onRef:o.createImageOnRef,images:l,disableButton:h,resetUploadImg:o.resetUploadImg,handleInputActive:o.handleInputActive,updatePublishStatus:o.updatePublishStatus,handleImages:o.handleImages}),tt.a.createElement($t,{className:it()("CommentEditorV2-inputUpLoad-Icon",{"CommentEditorV2-inputUpLoad-Icon--active":m&&!u.length}),onRef:o.createStickerOnRef,disableButton:h,handleEmotionClick:o.handleEmotionClick,handleStickerPopoverOpen:o.handleStickerPopoverOpen,handleStickerPopoverClose:o.handleStickerPopoverClose,stickerIconActive:m,sticker:u,stickers:i,resetStickers:o.resetStickers,addSticker:o.addSticker}))))},r=n,S(o,r)}return N(t,e),tn(t,[{key:"componentDidMount",value:function(){this.initLocalComment(),document.addEventListener("click",this.handleBlur)}},{key:"componentWillUnmount",value:function(){this.saveLocalComment(),document.removeEventListener("click",this.handleBlur)}},{key:"render",value:function(){var e=this.props,t=e.replyTo,n=e.commentNeedsReview,o=e.className,r=e.ownerAuthorIsOrg,a=e.ownerAuthorIsBrand,i=(e.type,e.id,e.edition,e.shouldOia,e.location.query,e.referer,this.state),s=i.active,c=i.disabled,l=r?"机构":"作者",u={preset:"primary",color:"blue",children:"发布",disabled:c};if(t){var m=Nt()(nn,t.author.member.name,n?"，评论由"+l+"筛选后公开":"");return tt.a.createElement("div",{className:it()(o,"CommentEditorV2--normal",{"CommentEditorV2--active":s})},this.renderInput({placeholder:m}),tt.a.createElement(Tt.c,en({},u,{className:"CommentEditorV2-singleButton",onClick:this.handleSubmit})))}var p="写下你的评论...";n&&(p=a?"已开启预审评论，评论由品牌筛选后公开":r?"已开启预审评论，评论由机构筛选后公开":"评论由作者筛选后显示");it()(o,"CommentEditorV2--normal"),this.state.shown;return tt.a.createElement("div",{className:it()(o,"CommentEditorV2--normal",{"CommentEditorV2--active":s})},this.renderInput({placeholder:p}),tt.a.createElement(Tt.c,en({},u,{className:"CommentEditorV2-singleButton",onClick:this.handleSubmit})))}}]),t}(et.Component),xe.propTypes={className:ot.a.string,defaultActive:ot.a.bool,replyTo:ot.a.object,inCommentItem:ot.a.bool,commentNeedsReview:ot.a.bool,canComment:ot.a.object,onCancel:ot.a.func,onSubmit:ot.a.func.isRequired},xe.defaultProps={defaultActive:!1,replyTo:null,inCommentItem:!1,autoFocus:!0,ownerAuthorIsOrg:!1,ownerAuthorIsBrand:!1},xe.contextTypes={authRequired:ot.a.func},Re=Ae))||Re)||Re),rn=n(1281),an=n(441),sn=(n(267),n(40),n(39)),cn=n(272),ln=n(118),un=n(37),mn=n(273),pn=n(50),dn=(n(1590),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),fn=function(e){function t(){var e,n,o,r;T(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=R(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={previewImg:null},o.handlePreview=function(e){var t=e.target;o.setState({previewImg:t})},r=n,R(o,r)}return x(t,e),dn(t,[{key:"mount",value:function(){var e=this;this.imagesGifNode=this.root.getElementsByClassName("comment_gif"),this.imagesNode=this.root.getElementsByClassName("comment_img"),this.imagesStickerNode=this.root.getElementsByClassName("comment_sticker"),this.imagesNodes=Array.from([].concat(j(this.imagesGifNode),j(this.imagesNode),j(this.imagesStickerNode))).map(function(t){var n=t.dataset||{},o=n.width,r=n.height,a=document.createElement("div");a.className="Richtext-content_img",t.parentNode.replaceChild(a,t);var i=t.getAttribute("href"),s=new Image,c=t.getAttribute("class");return"comment_sticker"!==c&&a.addEventListener("click",e.handlePreview),s.classList.add(c),s.src=i,s.dataset.original=Object(Jt.a)(i,"r"),s.dataset.rawwidth=o,s.onload=function(){Number(o)===Number(r)||"comment_sticker"===c?a.classList.add("Richtext-content_img-square"):Number(o)>Number(r)?a.classList.add("Richtext-content_img-square--wideShape"):a.classList.add("Richtext-content_img-square--highShape"),a.appendChild(s)},a})}},{key:"unmount",value:function(){this.imagesNodes&&this.imagesNodes.forEach(function(e){Object(Pt.unmountComponentAtNode)(e)})}},{key:"componentDidMount",value:function(){this.mount()}},{key:"componentWillUpdate",value:function(e){this.props.html!==e.html&&this.unmount()}},{key:"componentDidUpdate",value:function(e){e.html!==this.props.html&&this.mount()}},{key:"componentWillUnmount",value:function(){this.unmount()}},{key:"render",value:function(){var e=this,t=this.state.previewImg,n=this.props.html;return tt.a.createElement("div",{className:"CommentRichText",ref:function(t){return e.root=t}},tt.a.createElement(pn.a,{html:n}),t&&tt.a.createElement(mn.a,{className:"CommentRichText-ImageView",img:t,onClose:function(){return e.setState({previewImg:null})}}))}}]),t}(et.Component),hn=n(8),vn=n(89),yn=n(271),bn=(n(1591),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),gn=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Cn=(Le=Object(rt.connect)(function(e){return{edition:Object(Xt.c)(e),referer:Object(Xt.g)(e),isWechat:e.env.userAgent.Wechat}}),Object(_t.withRouter)(De=Le((Fe=Me=function(e){function t(){var e,n,o,r;A(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=L(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={reportModalShown:!1,isReplying:!1,collapsed:!0,guideShown:!1},o.toggleReply=o.context.authRequired(function(){o.setState({isReplying:!o.state.isReplying})},void 0,ut.b),o.openReportModal=o.context.authRequired(function(){o.setState({reportModalShown:!0})}),o.like=o.context.authRequired(function(e){var t=o.props;(0,t.onLike)(t.comment.id,e)},hn.C.like,ut.b),o.dislike=o.context.authRequired(function(){var e=o.props;(0,e.onDislike)(e.comment.id)},hn.C.like,ut.b),o.delete=function(){var e=o.props;return(0,e.onDelete)(e.comment.id)},o.feature=function(e){var t=o.props,n=t.onFeature,r=t.comment.id;n(e?r+"_featured":r)},o.collapse=function(){var e=o.props;(0,e.onCollapse)(e.comment.id)},o.approve=function(){var e=o.props;(0,e.onApprove)(e.comment.id)},o.reject=function(){var e=o.props;(0,e.onReject)(e.comment.id)},o.showConversation=function(e){var t=o.props;(0,t.onShowConversation)({commentId:t.comment.id,isAnchorComments:e})},o.stopReply=function(){o.setState({isReplying:!1})},o.closeReportModal=function(e){if(e){var t=e.result.payload,n=t&&t.message||t&&t.code&&"举报失败";e.commentDeleteResult&&!(e.commentDeleteResult.payload||{}).code?cn.b.showModal({reportText:n}):Object(vn.b)(n||"举报成功")}o.setState({reportModalShown:!1})},o.handleToggleGuide=function(){o.setState({guideShown:!o.state.guideShown})},o.handleCloseDelete=function(){return o.setState({deleteModal:!1})},o.handleDelete=function(){return o.setState({deleteModal:!0})},r=n,L(o,r)}return D(t,e),gn(t,[{key:"renderRoleInfo",value:function(e,t){return"normal"===e?null:tt.a.createElement("span",{className:"CommentItemV2-roleInfo"},"ancestor"===e||"author"===e&&"question"===t?" (提问者) ":" (作者) ")}},{key:"renderReplyTo",value:function(){var e=this.props.comment,t=e.replyToAuthor,n=e.resourceType;if(!t)return null;var o=t.member,r=void 0===o?{}:o,a=t.role;return tt.a.createElement("span",null,tt.a.createElement("span",{className:"CommentItemV2-reply"},"回复"),tt.a.createElement(un.a,{className:it()({"CommentItemV2-userLink":void 0}),noBadge:!0,noHoverCard:!0,user:r}),this.renderRoleInfo(a,n))}},{key:"renderItem",value:function(){var e=this,t=this.props,n=t.comment,o=n.isDelete,r=n.collapsed,a=t.isConversation,i=t.ownerAuthorIsOrg,s=(t.edition,r&&a&&this.state.collapsed),c=o||s,l=this.state,u=l.reportModalShown,m=l.isReplying,p=this.props,d=p.parent,f=d.canComment;f=void 0===f?{status:!0}:f;var h=f.status,v=d.questionType,y=p.commentNeedsReview,b=p.comment,g=p.onReply,C=p.status,E=p.type,w=p.canOperate,O=p.commentPattern,k=p.isMobile,P=p.rootCommentId,_=p.byComment,I=p.isReverseAndStatusOpen,S=p.hasRecommend,N=p.isQuestionAuthor,j=b.id,T=b.author,R=b.content,x=b.voteCount,A=b.replyToAuthor,L=b.isAuthor,D=(b.isParentAuthor,b.createdTime),M=b.featured,F=b.voting,B=b.reviewing,V=b.disliked,q=b.resourceType,U=b.childCommentCount,z=b.allowDelete,W=b.allowVote,G=b.canRecommend,H=b.canCollapse,K=b.collapsedReason,Y=void 0===K?"":K,Q=T||{},J=Q.member,Z=Q.role,$=Boolean(A),X=M&&(U>0||$)&&!a,ee=_&&$,te=I&&$,ne=X||ee||te,oe=void 0,re=L||z&&("question"!==E||"commercial"===v),ae=tt.a.createElement("div",{className:it()("CommentItemV2-footer",{"CommentItemV2-mobileFooter":void 0})},tt.a.createElement(Tt.c,{className:it()("CommentItemV2-likeBtn",F&&"is-liked"),preset:"plain",onClick:this.like,disabled:L},tt.a.createElement(Ct.Y,{style:{marginRight:5},center:!0,size:16}),x>0?x:"赞"),r&&Y&&tt.a.createElement("div",{className:"CommentItemV2-walleTag"},"阴阳怪气自动折叠"===Y&&tt.a.createElement(Ct.c,{size:16,className:"CommentItemV2-walleIcon"}),Y),ne&&tt.a.createElement(Tt.c,{preset:"plain",className:"CommentItemV2-talkBtn",onClick:function(){return e.showConversation($)}},tt.a.createElement(Ct.r,{style:{marginRight:5},center:!0,size:16}),"查看回复"),!L&&h&&!r&&tt.a.createElement(Tt.c,{preset:"plain",className:it()({"CommentItemV2-hoverBtn":!m}),onClick:this.toggleReply},tt.a.createElement(Ct._12,{style:{marginRight:5},center:!0,size:16}),m?"取消回复":"回复"),G&&!S&&w&&!k&&tt.a.createElement(Tt.c,{className:it()({"CommentItemV2-hoverBtn":!L&&!m}),preset:"plain",onClick:function(){return e.feature(M)}},tt.a.createElement(Ct._10,{style:{marginRight:5},center:!0,size:16}),M?"取消推荐":"推荐"),H&&!L&&!k&&tt.a.createElement(Tt.c,{className:it()({"CommentItemV2-hoverBtn":!L&&!m}),preset:"plain",onClick:this.collapse},tt.a.createElement(Ct.B,{style:{marginRight:5},center:!0,size:14}),r?"取消折叠":"折叠"),W&&!L&&w&&!k&&tt.a.createElement(Tt.c,{className:it()({"CommentItemV2-hoverBtn":!m}),preset:"plain",onClick:this.dislike},tt.a.createElement(Ct.Y,{style:{transform:"rotate(180deg)",marginRight:5},size:16,center:!0}),V?"取消踩":"踩"),L||tt.a.createElement(tt.a.Fragment,null,tt.a.createElement(Tt.c,{className:it()({"CommentItemV2-hoverBtn":!0}),preset:"plain",onClick:this.openReportModal},tt.a.createElement(Ct._13,{style:{marginRight:5},center:!0,size:16}),"举报"),"question"===E&&"commercial"===v&&N&&tt.a.createElement(Tt.c,{className:it()({"CommentItemV2-hoverBtn":!0}),preset:"plain",onClick:this.reject},tt.a.createElement(Ct.B,{style:{marginRight:5},center:!0,size:16}),"隐藏")),re&&!0&&tt.a.createElement(Tt.c,{className:it()({"CommentItemV2-hoverBtn":!L&&!m&&!m}),preset:"plain",onClick:this.handleDelete},tt.a.createElement(Ct._22,{style:{marginRight:5},center:!0,size:16}),"删除"),void 0,void 0,tt.a.createElement(cn.a,{shown:this.state.deleteModal,id:j,onDelete:this.delete,onClose:this.handleCloseDelete}),tt.a.createElement(ln.a,bn({type:"comment",urlToken:j,shown:u,onClose:this.closeReportModal},re&&{onDeleteComment:this.delete},{notification:{failure:yn.a},zaEnabled:!0})));return oe=m?tt.a.createElement("div",null,ae,tt.a.createElement(on,{type:"comment",id:j,commentNeedsReview:y,className:"CommentItemV2-editor",defaultActive:!0,replyTo:b,onCancel:this.stopReply,onSubmit:g,rootCommentId:P,isConversation:a})):"reviewing"===C?tt.a.createElement("div",{className:"CommentItemV2-footer"},tt.a.createElement(Tt.c,{preset:"plain",onClick:this.approve},tt.a.createElement(Ct.A,{style:{marginRight:5},center:!0,size:14}),"公开"),tt.a.createElement(Tt.c,{className:it()({"CommentItemV2-hoverBtn":!0}),preset:"plain",onClick:this.handleDelete},tt.a.createElement(Ct._22,{style:{marginRight:5},center:!0,size:16}),"删除")):ae,tt.a.createElement("div",null,tt.a.createElement("div",{className:"CommentItemV2-meta"},J&&tt.a.createElement(un.a,{className:"CommentItemV2-avatar",avatar:!0,noHoverCard:"fixed"===O,user:J}),J&&tt.a.createElement(un.a,{className:it()({"CommentItemV2-userLink":void 0}),noBadge:!0,noHoverCard:!0,user:J}),this.renderRoleInfo(Z,q),this.renderReplyTo(),B&&tt.a.createElement(Ct.B,{className:"CommentItemV2-reviewing","data-tooltip":!1===i?"评论未公开，由作者筛选后显示":"已开启预审评论，评论由机构筛选后公开",center:!0,size:14}),tt.a.createElement("span",{className:"CommentItemV2-time"},Object(sn.c)(D))),tt.a.createElement("div",{className:"CommentItemV2-metaSibling"},s&&tt.a.createElement("div",{className:"CommentItemV2-deletedContent"},"评论已被折叠"),o&&tt.a.createElement("div",{className:"CommentItemV2-deletedContent"},"评论已被删除"),!c&&tt.a.createElement(fn,{className:"CommentItemV2-content",html:R}),!c&&oe))}},{key:"render",value:function(){var e=this.props,t=(e.parent,e.parent);t.type,t.id,e.isWechat,e.edition,e.referer,e.location.query;return this.renderItem()&&tt.a.createElement("div",{className:"CommentItemV2",ref:this.props.onRef},this.renderItem(),void 0)}}]),t}(et.Component),Me.propTypes={comment:ot.a.object.isRequired,parent:ot.a.object.isRequired,commentNeedsReview:ot.a.bool,type:ot.a.string,isConversation:ot.a.bool,onLike:ot.a.func.isRequired,onShowConversation:ot.a.func,onReply:ot.a.func,onFeature:ot.a.func,onDelete:ot.a.func.isRequired,onCollapse:ot.a.func,commentPattern:ot.a.string,isMobile:ot.a.bool},Me.contextTypes={currentUser:ot.a.object,authRequired:ot.a.func},De=Fe))||De)||De),En=(n(1592),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),wn=5,On=2,kn=(Ve=Be=function(e){function t(){var e,n,o,r;F(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=B(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={},o.handleClick=function(){var e=o.props,t=e.loadRestComments,n=e.onShowConversation,r=e.comment,a=r.id,i=r.childCommentCount,s=i<=wn&&i>On;(s?t:n)({commentId:a}),s&&o.setState(M({},"hide_"+a,!0))},o.handleRef=function(e){var t=o.props.onRef;"function"==typeof t&&t(e)},r=n,B(o,r)}return V(t,e),En(t,[{key:"render",value:function(){var e=this.props,t=e.comment,n=t.id,o=t.childCommentCount,r=e.isFetching,a=e.className,i=this.state["hide_"+n],s=o<=wn&&o>On,c=s?"展开其他 "+(o-On)+" 条回复":"查看全部 "+o+" 条回复";return tt.a.createElement("div",{className:a,ref:this.handleRef},!i&&tt.a.createElement("div",{className:"CommentMoreReplyButton"},tt.a.createElement(Tt.c,{preset:"plain",onClick:this.handleClick},c)),r&&tt.a.createElement(Et.a,{className:"CommentMoreReplyButton",small:!0}))}}]),t}(et.Component),Be.propTypes={comment:ot.a.object.isRequired,isFetching:ot.a.bool,onShowConversation:ot.a.func,loadRestComments:ot.a.func},Ve),Pn=(n(1593),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),_n=(qe=Object(rt.connect)(null,{loadConversation:f}))(Ue=function(e){function t(){var e,n,o,r;q(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=U(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.loadRestComments=function(e){var t=e.commentId;(0,o.props.loadConversation)({id:t,isLoadRest:!0})},r=n,U(o,r)}return z(t,e),Pn(t,[{key:"render",value:function(){var e=this.props,t=e.parent,n=t.type,o=t.author;o=void 0===o?{isOrg:!1}:o;var r=o.isOrg,a=e.isMobile,i=e.parent,s=e.commentNeedsReview,c=e.onShowConversation,l=e.status,u=e.onItemLike,m=e.onItemDelete,p=e.onItemCollapse,d=e.onItemDislike,f=e.onItemApprove,h=e.onItemReject,v=e.canOperateItem,y=e.commentPattern,b=e.conversation,g=void 0===b?{}:b,C=e.entities,E=e.byComment,w=e.isReverseAndStatusOpen,O=e.comment,k=e.onReply,P=e.onFeature,_=e.ids,I=e.isAuthor,S=O.id,N=O.featured,j=O.childComments,T=void 0===j?[]:j,R=O.childCommentCount,x=void 0===R?0:R,A=N?S+"_featured":""+S,L=!N,D=L&&_.includes(S+"_featured"),M=Boolean(T.length)&&!w,F=x<=5&&x>2,B=T.map(function(e){return C.comments[e]}),V=!N&&x>2&&!w,q=F&&g[S]||{isFetching:!1},U=q.isFetching;return tt.a.createElement(et.Fragment,null,tt.a.createElement("li",{className:it()({"NestComment--rootCommentNoChild":!M,"NestComment--rootComment":M}),key:A},tt.a.createElement(Cn,{key:A,isMobile:a,comment:O,status:l,type:n,parent:i,canOperate:v,commentNeedsReview:s,onShowConversation:c,ownerAuthorIsOrg:r,onLike:u,onReply:k,onFeature:P,onDelete:m,onCollapse:p,onDislike:d,onApprove:f,onReject:h,commentPattern:y,rootCommentId:S,byComment:E,isReverseAndStatusOpen:w,hasRecommend:D,isQuestionAuthor:I})),M&&B.map(function(e){var t=e.id,o=e.featured,b=o?t+"_featured":""+t,g=!o,C=g&&_.includes(t+"_featured");return tt.a.createElement("li",{className:"NestComment--child",key:b},tt.a.createElement(Cn,{key:b,isMobile:a,comment:e,status:l,type:n,parent:i,canOperate:v,commentNeedsReview:s,onShowConversation:c,ownerAuthorIsOrg:r,onLike:u,onReply:k,onFeature:P,onDelete:m,onCollapse:p,onDislike:d,onApprove:f,onReject:h,commentPattern:y,rootCommentId:S,hasRecommend:C,isQuestionAuthor:I}))}),V&&tt.a.createElement(kn,{comment:O,isFetching:U,onShowConversation:c,loadRestComments:this.loadRestComments}))}}]),t}(et.Component))||Ue,In=n(83),Sn=n(66),Nn=n(24),jn=(n(1594),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),Tn=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Rn=(ze=Object(rt.connect)(Y,{loadComments:s,loadConversation:f,addComment:c,loadStickers:a,clearNotification:ut.d,getCommentWithPicPermission:r,loadNotificationComments:i,loadAnswerCommentPermission:In.c,loadArticleCommentPermission:Sn.b}))((He=Ge=function(e){function t(){var e,n,o,r;G(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=H(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={collapsed:!0,current:1,packupButtonStatus:!1,packupButtonLeft:0},o.load=function(e,t,n){if(!o.props.isFetching&&!o.props.parent.adminClosedComment){var r=e||o.props,a=r.order,i=r.status,s=r.parent,c=s.id,l=s.type,u=r.commentPattern,m=r.needLoadCommentPermission,p=r.loadComments,d=r.notificationId,f=r.loadNotificationComments;if(d)return f(d);if(m&&o.loadCommentPermission(l,c),n){p(l,c,{order:a,isPrevious:t,status:"collapsed",commentPattern:u},!0)}else p(l,c,{order:a,isPrevious:t,status:i,commentPattern:u})}},o.addComment=function(e,t,n){var r=n.rootCommentId,a=n.isConversation,i=o.props,s=i.parent,c=s.id,l=s.type,u=i.commentId,m=i.addComment,p=i.notificationId;return m({parentType:l,parentId:c,content:e,replyTo:t,conversationId:u,rootCommentId:r,isConversation:a,notificationId:p,replyType:W({id:r,replyTo:t,isConversation:a,isNotification:Boolean(p)}).type})},o.featureItem=function(e){(0,o.props.onItemFeature)(e,o.lastFeaturedIndex)},o.handleOpenCollapsed=function(){o.setState({collapsed:!1}),o.load(o.props,!1,!0)},o.handleScroll=function(){if(o.commentsElement&&o.commentsWithPaginationEl){var e=window.innerHeight,t=o.state.packupButtonStatus,n=o.commentsWithPaginationEl.getBoundingClientRect(),r=n.top,a=n.bottom,i=n.height;!t&&i>500&&a>e&&r<0?o.setState({packupButtonStatus:!0}):t&&(i<=500||a<=e||r>=0)&&o.setState({packupButtonStatus:!1})}},o.handlePaginationClick=function(e){var t=o.props.onPaginationClick,n=o.state.current;t&&t(n,e),o.commentsElement.scrollIntoView(),o.setState({current:e}),o.loadByPagination(e)},o.loadByPagination=function(e,t){var n=t||o.props,r=n.order,a=n.status,i=n.parent,s=i.id,c=i.type,l=n.commentPattern,u=n.needLoadCommentPermission,m=n.loadComments;u&&o.loadCommentPermission(c,s),m(c,s,{order:r,isPrevious:!1,status:a,commentPattern:l,current:e})},o.renderComment=function(e){var t=e.id,n=e.featured,r=n?t+"_featured":t;return tt.a.createElement("ul",{className:"NestComment",key:r},tt.a.createElement(_n,jn({comment:e,onReply:o.addComment,onFeature:o.featureItem},o.props)))},o.renderNormalComments=function(e){var t=o.state.collapsed,n=o.props,r=n.byComment,a=n.lastFeaturedIndex,i=n.parent,s=i.featuredCounts,c=i.commonCounts,l=[],u=s>0;return o.lastFeaturedIndex=0,e.length>0&&e.forEach(function(n,i){if(r||!n.collapsed){var m=e[i-1];n.collapsed&&(m&&m.collapsed||l.push(o.renderCollapsedDivider()),t)||(i===a&&l.push(tt.a.createElement("div",{className:"NestComment-nextSiblings--noBorder",key:"NestComment-nextSiblings--noBorder"})),u&&0===i&&-1!==a&&l.push(tt.a.createElement("div",{className:"CommentListV2-header-divider",key:"divider-featured"},"精选评论（",s,"）")),l.push(o.renderComment(n)),i===a&&(o.lastFeaturedIndex=i,l.push(tt.a.createElement("div",{className:"CommentListV2-header-divider",key:"divider-comment"},"评论（",c,"）"))))}}),l},o.renderCollapsedComments=function(){var e=[],t=o.props.collapsedComments;return o.state.collapsed||!t||t.length<=0?[]:(e.push(t.map(function(e){return o.renderComment(e)})),e)},o.renderComments=function(e){return e.map(o.renderComment)},o.renderCollapsedDivider=function(){var e=o.props,t=e.isDrained,n=e.parent.collapsedCounts;return!t||n<=0?[]:o.state.collapsed?tt.a.createElement("div",{className:"CommentListV2-action",key:"collapsed"},tt.a.createElement("div",{className:"CommentListV2-expendCollapseButton"},tt.a.createElement("span",{onClick:o.handleOpenCollapsed},Object(Ot.a)(n)," 条评论被折叠"),"（",tt.a.createElement("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）")):tt.a.createElement("div",{className:"CommentListV2-divider",key:"divider-collapsed"},tt.a.createElement("div",{className:"CommentListV2-dividerLine"}),tt.a.createElement("div",{className:"CommentListV2-dividerText"},Object(Ot.a)(n)," 条评论被折叠（",tt.a.createElement("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）"))},o.renderCollapsedInfiLoader=function(){var e=o.state.collapsed;if(e)return[];var t=o.props.collapsedInfo;t=void 0===t?{}:t;var n=t.isFetching,r=t.isPrevDrained,a=t.isDrained;return tt.a.createElement(Et.b,{className:"CommentListV2",onRef:function(e){o.listEl=e},isLocal:!0,isLoading:n,isPrevDrained:r,isDrained:a,onLoad:function(t){return o.load(o.props,t,!e)},placeholder:tt.a.createElement(Et.a,{className:"CommentItem",small:!0})},o.renderCollapsedComments())},o.renderPatternContent=function(e){var t=o.props,n=t.isFetching,r=t.parent.adminClosedComment,a=t.byComment,i=t.status,s=t.order,c=t.totals,l=t.handlePackupButton,u=t.apps,m=Math.ceil(c/20),p=o.state,d=p.current,f=p.packupButtonStatus,h=p.packupButtonLeft;return r?null:n?tt.a.createElement(rn.a,{onRef:function(e){o.commentsWithPaginationEl=e}}):tt.a.createElement("div",{ref:function(e){o.commentsWithPaginationEl=e}},tt.a.createElement("div",{className:"CommentListV2"},"normal"===s&&"open"===i?o.renderNormalComments(e):o.renderComments(e)),m>1&&tt.a.createElement(wt.a,{current:d,className:"CommentsV2-pagination",total:m,clickCallback:o.handlePaginationClick}),!a&&o.renderCollapsedDivider(),!a&&o.renderCollapsedInfiLoader(),tt.a.createElement(vt.CSSTransitionGroup,{transitionName:"CommentsV2-Packup-Button",transitionEnterTimeout:300,transitionLeaveTimeout:300},f&&"column"!==u&&tt.a.createElement("button",{onClick:l,className:"CommentsV2-Packup-Button",style:{left:h}},"收起评论",tt.a.createElement(Ct.g,{center:!0}))))},o.renderModalContent=function(e){var t=o.props,n=t.collapsedInfo,r=t.parent.adminClosedComment,a=t.status,i=t.order,s=t.byComment,c=o.state.collapsed,l=c?o.props:n,u=l.isFetching,m=l.isDrained,p=l.isPrevDrained;if(m&&e.length<=0||r)return tt.a.createElement("div",{className:"CommentsV2-empty"},tt.a.createElement(kt.a,{entityType:"comments"}));var d={getContainer:function(e){return e}};return tt.a.createElement(Et.b,jn({className:"CommentListV2",onRef:function(e){o.listEl=e},isLocal:!0,isLoading:u,isPrevDrained:p,isDrained:m,onLoad:function(e){return o.load(o.props,e,!c)},placeholder:tt.a.createElement(Et.a,{className:"CommentItemV2",small:!0})},d),"normal"===i&&"open"===a?o.renderNormalComments(e):o.renderComments(e),!s&&o.renderCollapsedDivider(),!s&&o.renderCollapsedComments())},o.renderCommentEdit=function(){var e=o.props,t=e.parent,n=t.canComment;n=void 0===n?{status:!0}:n;var r=n.status,a=n.reason,i=t.author;i=void 0===i?{isOrg:!1}:i;var s=i.isOrg,c=t.type,l=t.id,u=t.adminClosedComment,m=t.questionType,p=e.byComment,d=e.isAutoblur,f=e.commentNeedsReview,h=u?"当前内容暂时无法评论":a,v=d?!d:!p;return r&&!u?tt.a.createElement(on,{className:"CommentsV2-footer",type:c,id:l,commentNeedsReview:f,onSubmit:o.addComment,autoFocus:v,ownerAuthorIsOrg:s,ownerAuthorIsBrand:"commercial"===m}):tt.a.createElement("div",{className:it()("CommentsV2-disabledText",{"CommentsV2-disabledText--fixed":void 0})},tt.a.createElement("div",{className:"CommentsV2-disabledReason"},h))},r=n,H(o,r)}return K(t,e),Tn(t,[{key:"loadCommentPermission",value:function(e,t){var n=this.props,o=n.loadAnswerCommentPermission,r=n.loadArticleCommentPermission;switch(e){case"answer":return o(t);case"article":return r(t);default:return null}}},{key:"componentDidMount",value:function(){this.subscription=Object(yt.subscribe)("scroll",this.handleScroll);var e=this.props,t=e.commentPattern,n=e.parent.adminClosedComment,o=e.stickers,r=e.loadStickers,a=e.getCommentWithPicPermission,i=e.commentWithPicPermission,s=e.currentUser,c=this.state.current;"bottom"!==t||n||(this.loadByPagination(c),this.commentsWithPaginationEl&&this.setState({packupButtonLeft:this.commentsWithPaginationEl.getBoundingClientRect().right-16})),!o.length&&r(),void 0===i.commentWithPic&&s&&a()}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.order,o=t.status,r=t.targetComment,a=t.commentPattern;n===e.order&&o===e.status||("bottom"===a?(this.setState({current:1}),this.loadByPagination(1,e)):this.load(e),this.setState({collapsed:!0}));var i=e.targetComment;!r&&i&&this.setState({collapsed:!i.collapsed})}},{key:"componentWillUnmount",value:function(){Object(ut.d)(ut.b),this.subscription&&this.subscription.unsubscribe()}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,o=t.isAuthor,r=t.comments,a=t.commentPattern,i=t.parent,s=i.author;s=void 0===s?{isOrg:!1}:s;var c=s.isOrg,l=i.commentPermission,u=i.reviewingCounts,m=i.commentCount,p=i.adminClosedComment,d=t.totals,f=t.status,h=t.order,v=t.onStatusChange,y=t.apps,b=t.onOrderChange,g=t.targetLink,C=t.shouldReverse,E=r.filter(function(e){return!e.isDelete}),w="censor"===l&&o,O=w?{isCommentReviewer:w,onStatusChange:v,status:f,reviewingCounts:u}:{status:f};return tt.a.createElement("div",{className:it()("CommentsV2 CommentsV2--withEditor",{"CommentsV2-withPagination":"bottom"===a},n),ref:function(t){e.commentsElement=t}},tt.a.createElement(an.a,jn({commentCount:void 0!==m?m:d,shouldReverse:C,commentClosed:p,targetLink:g,order:h,onOrderChange:b,commentPattern:a,isOrg:c},O)),"column"===y&&this.renderCommentEdit(),"bottom"===a?this.renderPatternContent(E):this.renderModalContent(E),"column"!==y&&this.renderCommentEdit())}}]),t}(et.Component),Ge.propTypes={type:ot.a.string,parent:ot.a.object.isRequired,targetLink:ot.a.node,commentNeedsReview:ot.a.bool,byComment:ot.a.oneOfType([ot.a.number,ot.a.string]),commentPattern:ot.a.string,handlePackupButton:ot.a.func,onPaginationClick:ot.a.func,isAutoblur:ot.a.bool,shouldReverse:ot.a.bool},Ge.contextTypes={authRequired:ot.a.func.isRequired},Ge.defaultProps={isAutoblur:!1,shouldReverse:!0},We=He))||We,xn=n(80),An=n.n(xn),Ln=n(265),Dn=n.n(Ln),Mn=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Fn=(Ke=Object(rt.connect)(X,{loadConversation:f,addComment:c,loadMoreAnchorComments:h}))((Je=Qe=function(e){function t(){var e,n,o,r;J(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=Z(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.load=function(){var e=o.props,t=e.isAnchorComments,n=e.conversationId;(0,e.loadConversation)({id:n,isAnchorComments:t})},o.addComment=function(e,t,n){var r=n.rootCommentId,a=n.isConversation,i=o.props,s=i.parent,c=s.type,l=s.id,u=i.conversationId,m=i.addComment,p=i.isAnchorComments;return m({parentType:c,parentId:l,content:e,replyTo:t,conversationId:u,rootCommentId:r,isConversation:a,replyType:W({id:r,replyTo:t,isConversation:a}).type,isAnchorComments:p})},o.loadMoreAnchorComments=function(){var e=o.props,t=e.conversationId,n=e.topCommentsPaging,r=void 0===n?{}:n;(0,e.loadMoreAnchorComments)({conversationId:t,nextUrl:r.next})},o.createOnRef=An()(function(e){return function(t){var n=o.props.byComment;parseInt(e)===Number(n)&&(o.targetCommentEl=t)}}),o.scrollToTarget=function(){var e=o,t=e.targetCommentEl,n=e.listEl;if(n&&t){var r=t.getBoundingClientRect(),a=r.top,i=r.height,s=n.getBoundingClientRect(),c=s.top,l=s.height;o.listEl.scrollTop+=a-c-(l-i)/2,t.classList.add("CommentItemV2--highlighted"),setTimeout(function(){return t.classList.remove("CommentItemV2--highlighted")},2e3),t.tabIndex=-1,t.focus()}},r=n,Z(o,r)}return $(t,e),Mn(t,[{key:"componentDidMount",value:function(){this.props.byComment&&this.scrollToTarget()}},{key:"componentDidUpdate",value:function(e){!e.comments.length&&this.props.comments.length&&this.props.byComment&&this.scrollToTarget()}},{key:"render",value:function(){var e=this,t=this.props,n=t.onItemLike,o=t.onItemDelete,r=t.onItemFeature,a=t.onItemApprove,i=t.onItemCollapse,s=t.onItemDislike,c=t.onNavBack,l=t.canOperateItem,u=t.isFetching,m=t.comments,p=void 0===m?[]:m,d=t.commentNeedsReview,f=t.openComment.collapsed,h=t.parent,v=t.commentPattern,y=t.totals,b=t.isDrained,g=t.isPrevDrained,C=t.isConversationMoreFetching,E=t.isConversationMoreDrained,w=t.offsetIndex,O=null;return u&&!p.length?O=tt.a.createElement(et.Fragment,null,tt.a.createElement(Et.a,{className:"CommentItemV2",small:!0}),tt.a.createElement("div",{className:"CommentsV2-openComment-divider"}),tt.a.createElement("div",{className:"CommentsV2-replyNum"},y+" 条回复")):p.length&&(O=p.map(function(t,c){return c?E||c!==w||C?C&&c===w?tt.a.createElement(et.Fragment,{key:t.id},tt.a.createElement(Cn,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:d,canOperate:l,parent:h,comment:t,onLike:n,onDelete:o,onFeature:r,onApprove:a,onCollapse:i,onDislike:s,collapsedShown:f,onReply:e.addComment}),tt.a.createElement(Et.a,{key:"NestCoomment-moreCommentButton-PlaceHolder",className:"NestCoomment-moreCommentButton ",small:!0})):tt.a.createElement(Cn,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:d,canOperate:l,parent:h,comment:t,onLike:n,onDelete:o,onFeature:r,onApprove:a,onCollapse:i,onDislike:s,collapsedShown:f,onReply:e.addComment}):tt.a.createElement(et.Fragment,{key:t.id},tt.a.createElement(Cn,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:d,canOperate:l,parent:h,comment:t,onLike:n,onDelete:o,onFeature:r,onApprove:a,onCollapse:i,onDislike:s,collapsedShown:f,onReply:e.addComment}),tt.a.createElement("div",{key:"NestCoomment-moreCommentButton",preset:"plain",className:"NestCoomment-moreCommentButton",onClick:e.loadMoreAnchorComments},tt.a.createElement(Ct.d,null),tt.a.createElement("p",null,"点击查看更多回复"))):tt.a.createElement(et.Fragment,{key:t.id},tt.a.createElement("div",{className:"CommentsV2-openComment"},tt.a.createElement(Cn,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:d,canOperate:l,parent:h,comment:t,onLike:n,onDelete:o,onFeature:r,onApprove:a,onCollapse:i,onDislike:s,collapsedShown:f,onReply:e.addComment})),tt.a.createElement("div",{className:"CommentsV2-openComment-divider"}),tt.a.createElement("div",{key:t.id+"-title"},tt.a.createElement("div",{className:"CommentsV2-replyNum"},y+" 条回复")))})),"bottom"===v?tt.a.createElement(Rt.b,{size:"fullPage",onClose:c},tt.a.createElement("div",{className:"CommentsV2"},tt.a.createElement(an.a,{isConversation:!0,commentPattern:v}),tt.a.createElement(Et.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:u,isDrained:b,isPrevDrained:g,onLoad:this.load,placeholder:tt.a.createElement(Et.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e}},O))):tt.a.createElement("div",{className:"CommentsV2"},tt.a.createElement(an.a,{isConversation:!0,onNavBack:c}),tt.a.createElement(Et.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:u,isDrained:b,isPrevDrained:g,onLoad:this.load,placeholder:tt.a.createElement(Et.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e}},O))}}]),t}(et.Component),Qe.propTypes={conversationId:ot.a.number.isRequired,type:ot.a.string,parent:ot.a.object.isRequired,commentNeedsReview:ot.a.bool},Qe.contextTypes={currentUser:ot.a.object,authRequired:ot.a.func.isRequired},Ye=Je))||Ye,Bn=n(67),Vn=n.n(Bn),qn=(n(1595),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),Un=Object(_t.withRouter)(Ze=function(e){function t(){return ee(this,t),te(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ne(t,e),qn(t,[{key:"render",value:function(){var e=this.props,t=e.message,n=e.location.pathname;return tt.a.createElement("div",{className:"UnknownError"},t||tt.a.createElement("div",null,"遇到不可预料的问题，请检查网络链接或",tt.a.createElement("a",{href:n},"刷新重试"),"。"))}}]),t}(et.Component))||Ze,zn=Un,Wn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hn=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Kn=function(e){function t(){var e,n,o,r;re(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=ae(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={hasError:!1},r=n,ae(o,r)}return ie(t,e),Hn(t,[{key:"componentDidCatch",value:function(e,t){window.Raven&&window.Raven.captureException(e,{extra:t}),this.setState({hasError:!0})}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.replacement,o=e.message,r=oe(e,["children","replacement","message"]);if(this.state.hasError){var a=void 0===n?"undefined":Gn(n);return"undefined"===a?tt.a.createElement(zn,{message:o||"遇到不可预料的问题"}):"function"===a?n(Wn({},r,{children:t})):n}return t}}]),t}(et.Component),Yn=Kn,Qn=n(446),Jn=n(255),Zn=n(1596),$n=n.n(Zn),Xn=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),eo=($e=Object(rt.connect)(function(e){return{currentUser:Object(Nn.c)(e)}}))(Xe=function(e){function t(){var e,n,o,r;le(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=ue(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={ready:!1},o.handleInitPlugin=function(){var e=o.props.currentUser;e&&($n.a.setUserHash(e.id),$n.a.setExtra(JSON.stringify({js:se(),css:ce()}))),$n.a.init({hasButton:!1,version:"3.0.16"}).then(function(){return o.setState({ready:!0})})},r=n,ue(o,r)}return me(t,e),Xn(t,[{key:"componentDidMount",value:function(){window.addEventListener("load",this.handleInitPlugin)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("load",this.handleInitPlugin)}},{key:"render",value:function(){return this.state.ready&&tt.a.createElement(Qn.b,null)}}]),t}(et.Component))||Xe,to=eo,no=(n(1634),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),oo=(function(e){function t(){return pe(this,t),de(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}fe(t,e),no(t,[{key:"render",value:function(){return tt.a.createElement("div",{className:"GlobalError"},tt.a.createElement("div",{className:"GlobalError-main"},tt.a.createElement("div",{className:"GlobalError-logo"},tt.a.createElement(Jn.a,null)),tt.a.createElement("div",{className:"GlobalError-detail"},tt.a.createElement("div",{className:"GlobalError-detailTitle"},"服务器提了一个问题"),tt.a.createElement("p",null,"我们正在紧张地撰写答案")),tt.a.createElement("div",{className:"GlobalError-background"})),tt.a.createElement(Qn.c,null,tt.a.createElement(to,null)))}}])}(et.Component),n(1635),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),ro=(function(e){function t(){return he(this,t),ve(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}ye(t,e),oo(t,[{key:"render",value:function(){var e=this.props.placeholder;return tt.a.createElement("div",{className:"RetryError"},tt.a.createElement("div",{className:"RetryError-title"},e||"发生了不可预料的错误"),tt.a.createElement(Tt.c,{preset:"link",onClick:this.onRetry,icon:Ct._11},"点击重试"))}}])}(et.Component),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),ao=function(e){return function(t){var n=function(n){function o(){return be(this,o),ge(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return Ce(o,n),ro(o,[{key:"render",value:function(){var n=e&&!Object(et.isValidElement)(e)?e:{replacement:e};return tt.a.createElement(Yn,n,tt.a.createElement(t,this.props))}}]),o}(et.Component);return Vn()(n,t)}},io=ao;n.d(t,"default",function(){return ho});var so,co,lo,uo,mo,po=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},fo=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),ho=(so=Object(rt.connect)(function(e){return e},{updateCommentLikeStatus:l,updateCommentFeatureStatus:v,deleteComment:d,updateCommentCollapsed:y,updateCommentDisliked:u,approveComment:b,rejectComment:g}),co=io(null),so(lo=co((mo=uo=function(e){function t(){var e,n,o,r;we(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=Oe(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={openedCommentId:null,isAnchorComments:!1,status:"open",order:"normal"},o.showConversation=function(e){var t=e.commentId,n=e.isAnchorComments;o.setState({openedCommentId:t,isAnchorComments:n})},o.showComments=function(){o.setState({openedCommentId:null,isAnchorComments:!1})},o.delete=function(e){var t=o.props,n=t.parent;return(0,t.deleteComment)(e,n.type,n.id)},o.feature=function(e){var t=o.props,n=t.parent,r=t.updateCommentFeatureStatus,a=t.notificationId;r({id:o.state.openedCommentId,commentId:e,parentId:n.id,parentType:n.type,notificationId:a})},o.like=function(e,t){var n=o.props,r=n.onItemLike,a=n.updateCommentLikeStatus;r&&r(e,t),a(e)},o.collapse=function(e){var t=o.props,n=t.parent;(0,t.updateCommentCollapsed)(e,n.type,n.id)},o.dislike=function(e){(0,o.props.updateCommentDisliked)(e)},o.approve=function(e){var t=o.props,n=t.parent,r=t.type;(0,t.approveComment)(e,n.type||r,n.id)},o.reject=function(e){var t=o.props,n=t.parent,r=t.type;(0,t.rejectComment)(e,n.type||r,n.id)},o.handleStatusChange=function(e){o.setState({status:e})},o.handleOrderChange=function(e,t){var n=o.props.onOrderChange;n&&n(e,t),o.setState({order:e})},r=n,Oe(o,r)}return ke(t,e),fo(t,[{key:"componentDidMount",value:function(){var e=this.props.onMount;e&&e(this.commentsContainerNode)}},{key:"render",value:function(){var e=this,t=this.props,n=t.parent,o=t.commentPattern,r=t.type,a=t.parent;a=void 0===a?{}:a;var i=a.commentPermission,s=a.relationship,c=void 0===s?{}:s,l=a.author,u=void 0===l?{}:l,m=t.needLoadCommentPermission,p=t.byComment,d=Ee(t,["parent","commentPattern","type","parent","needLoadCommentPermission","byComment"]),f=this.context.currentUser,h=void 0===c.isAuthor?f&&u.urlToken&&f.urlToken===u.urlToken:c.isAuthor,v="censor"===i&&!h,y="answer"===r||"article"===r,b=this.state,g=b.openedCommentId,C=b.status,E=b.order,w=b.isAnchorComments,O=w&&(g||p)||p;return tt.a.createElement("div",{className:"Comments-container",ref:function(t){return e.commentsContainerNode=t}},tt.a.createElement(Rn,po({className:it()({"CommentsV2--hidden":g&&"bottom"!==o})},d,{type:r,order:E,status:C,parent:n,commentPattern:o,commentNeedsReview:v,canOperateItem:y,onShowConversation:this.showConversation,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve,onItemReject:this.reject,byComment:O,onStatusChange:this.handleStatusChange,onOrderChange:this.handleOrderChange,needLoadCommentPermission:m,isAuthor:h})),g&&tt.a.createElement(Fn,po({},d,{parent:n,type:r,canOperateItem:y,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve,onItemReject:this.reject,commentPattern:o,conversationId:g,onNavBack:this.showComments,byComment:O,isAnchorComments:w,commentNeedsReview:v,onShowConversation:this.showConversation})))}}]),t}(et.Component),uo.propTypes={type:ot.a.string.isRequired,parent:ot.a.object.isRequired,onOrderChange:ot.a.func,onItemLike:ot.a.func,isAuthor:ot.a.bool,onMount:ot.a.func},uo.defaultProps={type:"answer"},uo.contextTypes={currentUser:ot.a.object,authRequired:ot.a.func.isRequired},lo=mo))||lo)||lo)},1648:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e){return Array.isArray(e)||(e=[e]),e.map(function(e,t){return c.a.createElement("span",{className:"PushNotifications-actor",key:t},e.link?c.a.createElement("a",{href:e.link},e.name):c.a.createElement("span",null,e.name))})}Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),c=n.n(s),l=n(2),u=n.n(l),m=n(468),p=(n.n(m),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),d=function(e){function t(){var e,n,a,i;o(this,t);for(var s=arguments.length,l=Array(s),u=0;u<s;u++)l[u]=arguments[u];return n=a=r(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),a.renderTarget=function(){var e=a.props.item,t=e.content.target,n=t.text,o=t.link,r=e.id,i=e.target,s=e.target;s=void 0===s?{}:s;var l=s.id,u=s.target,m=void 0===u?{}:u,p=m.type;return i&&"comment"===i.type?a.renderCommentButton(n,{type:p,href:o,byComment:l,target:m,notificationId:r}):c.a.createElement("span",null,o?c.a.createElement("a",{href:o},n):c.a.createElement("span",null,n))},i=n,r(a,i)}return a(t,e),p(t,[{key:"renderCommentButton",value:function(e,t){var n=this,o=t.href,r=t.byComment,a=t.notificationId;return c.a.createElement("a",{href:o+(r?"#comment-"+r+"?notificationId="+a:""),onClick:function(e){e.preventDefault(),n.props.onCommentsModalOpen(t)}},e)}},{key:"render",value:function(){var e=this.props.item,t=e.content,n=t.verb,o=t.actors,r=e.isRead;return c.a.createElement("div",{className:u()("PushNotifications-item",{"PushNotifications-newItem":!r})},c.a.createElement("span",null,i(o))," ",n," ",this.renderTarget())}}]),t}(s.Component);t.default=d},1649:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){return e?t?!0===t?"":t:e:""}function s(e){for(var t,n=e.length,o=e.chars,r=e.maskChar,a=[],s=0;s<n;s+=1)t=o[s],a.push(C.a.createElement("span",{className:k()("TPassBox",{"TPassBox-mask":t&&Boolean(r)}),key:s},i(t,r)));return C.a.createElement("span",{className:"TPassBoxes"},a)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function f(){this.payments={},this.chosePaymentName=null,this.codeUrl="",this.qrLoaded=!1,this.need=null,this.passcode="",this.needSMS=!1,this.smsTimer=0,this.isInProgress=!1,this.error=null}function h(e,t){return H&&e&&e!==H&&t(new Error("A pay-sdk from different source has been load")),H=e,window.zhihu&&window.zhihu.pay?window.zhihu.pay.ready(t):(K||(K=Object(G.a)(e)),K.then(function(){return window.zhihu.pay.ready(t)},function(e){t(e),K=null}))}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var g=n(0),C=n.n(g),E=n(1),w=n.n(E),O=n(2),k=n.n(O),P=n(3),_=n(38),I=n(454),S=n(170),N=n(22),j=(n(1636),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),T={backspace:8,tab:9,enter:13,0:48,9:57},R=function(e){function t(e){o(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onInputFocus=n.onInputFocus.bind(n),n.onInputChange=n.onInputChange.bind(n),n.onKeyDown=n.onKeyDown.bind(n),n}return a(t,e),j(t,[{key:"onInputFocus",value:function(e){e.target.value=e.target.value,this.props.onFocus()}},{key:"onInputChange",value:function(e){var t=String(e.target.value);if(t){t=t[t.length-1];var n=this.props.chars,o=this.props.length;n.length===o?n=n.replace(/.$/,t):n+=t,this.props.onChange(n),n.length===o&&this.props.onFinish(n)}}},{key:"onKeyDown",value:function(e){var t=e.keyCode;if(!e.metaKey&&!e.ctrlKey&&t!==T.tab&&t!==T.enter){var n=this.props.chars;t===T.backspace?(n=n.slice(0,-1),this.props.onChange(n)):(t<T[0]||t>T[9])&&(e.preventDefault(),this.props.onError(e))}}},{key:"focus",value:function(){this.input.focus()}},{key:"blur",value:function(){this.input.blur()}},{key:"render",value:function(){var e=this,t=this.props,n=t.length,o=t.chars,r=t.maskChar,a=t.autoFocus,i=t.className,c=t.children,l=o.length===n?n-1:o.length,u=o[l]||"";return C.a.createElement("label",{className:k()("TPass",i)},C.a.createElement("span",{className:"TPass-wrapper"},C.a.createElement(s,{length:n,chars:o,maskChar:r}),C.a.createElement("input",{className:"TPass-input",value:u,style:{left:60*l},onFocus:this.onInputFocus,onChange:this.onInputChange,onKeyDown:this.onKeyDown,onPaste:function(e){return e.preventDefault()},type:"number",min:"0",max:"9",pattern:"[0-9]*",autoFocus:a,ref:function(t){e.input=t}})),c)}}]),t}(C.a.Component);R.defaultProps={length:6,chars:"",maskChar:!1,autoFocus:!1,onFocus:function(){},onChange:function(){},onError:function(){},onFinish:function(){}},R.propTypes={length:w.a.number,chars:w.a.string,maskChar:w.a.oneOfType([w.a.bool,w.a.string]),autoFocus:w.a.bool,onFocus:w.a.func,onChange:w.a.func,onError:w.a.func,onFinish:w.a.func,className:w.a.string,children:w.a.node};var x,A,L=R,D=(n(1637),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),M=(A=x=function(e){function t(){return c(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u(t,e),D(t,[{key:"render",value:function(){var e=this.props;return C.a.createElement("div",{className:k()("Spinner",e)},C.a.createElement("i",{className:"Spinner-loading"}))}}]),t}(g.Component),x.propTypes={className:w.a.string},A),F=n(176),B=(n(1638),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),U=11,z=function(e){function t(e){m(this,t);var n=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onPasscodeFocus=function(){n.state.error&&(n.setState({error:null}),6===n.state.passcode.length&&n.setState({passcode:""}))},n.onPasscodeInput=function(e){"object"===(void 0===e?"undefined":V(e))&&(e=e.target.value),n.setState({passcode:e})},n.onPasscodeFinish=function(e){n.tpass.blur(),n.payWithBalance(e)},n.onSendSMSCode=function(){n.props.trade.resendSMSCode(function(){n.startSMSTimer(),n.smsInput.focus()},function(e){n.setState({error:e})})},n.onQrLoad=function(){n.setState({qrLoaded:!0})},n.onBalanceFormSubmit=function(e){e.preventDefault(),n.payWithBalance(n.state.passcode)},n.setPayments=function(e){n.setState({payments:e})},n.confirmPayment=function(){var e=n.state,t=e.choseName,o=e.payments,r=n.props.onConfirmPayment,a=t;if(t||(a=o.balance&&o.balance.enable?"balance":"wechat"),r(!a),n.setState({chosePaymentName:a}),"wechat"===a&&n.isInWechat){var i=n.props.tradeNumber,s=location.protocol+"//"+location.host+location.pathname,c="https://www.zhihu.com/pay/weixin/pay?service_id="+U+"&trade_number="+i+"&redirect_uri="+encodeURIComponent(s);return void window.location.replace(c)}n.props.trade["wechat"===a?"initWechatPay":"initBalancePay"]()},n.pid=0,n.smsTimer=null,n.state=new f,n.isInWechat=e.ua.Wechat,n}return d(t,e),q(t,[{key:"componentWillMount",value:function(){var e=this.props.trade;this.getPaymentsList(e),this.initListeners(e)}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.trade!==this.props.trade&&(this.setState(new f),setTimeout(function(){t.getPaymentsList(e.trade)},300),this.initListeners(e.trade))}},{key:"componentWillUnmount",value:function(){window.clearInterval(this.smsTimer),this.props.trade.dispose()}},{key:"getPaymentsList",value:function(e){var t=this;if(e){var n=this.pid+=1;e.getPaymentsList(function(e){t.pid===n&&t.setPayments(e)})}}},{key:"initListeners",value:function(e){var t=this;e&&e.on("payInited",function(e,n){t.setState(B({},n))}).on("paySuccess",function(){t.setState({isInProgress:!1,error:null}),t.props.onSuccess()}).on("payCancel",function(){t.setState({isInProgress:!1,chosePaymentName:null})}).on("payFail",function(e){var n=e;"object"!==(void 0===e?"undefined":V(e))||e instanceof Error||(n=e.message),t.setState({isInProgress:!1,error:n}),t.props.onFail(e)}).on("needSMS",function(e){t.setState({isInProgress:!1,error:null,needSMS:e.message,passcode:""})}).on("needWechatCode",function(){t.props.onError("needWechatCode")}).on("error",function(e,n){t.props.onError(e,n)})}},{key:"startSMSTimer",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60;window.clearInterval(this.smsTimer),this.setState({smsTimer:t}),this.smsTimer=window.setInterval(function(){t-=1,t<=0?(window.clearInterval(e.smsTimer),e.smsTimer=null,e.setState({smsTimer:0})):e.setState({smsTimer:t})},1e3)}},{key:"payWithBalance",value:function(e){return 6!==e.length?(this.setState({error:"请输入 6 位支付密码"}),!1):(this.setState({isInProgress:!0,error:null}),this.props.trade.payWithBalance(e))}},{key:"renderPaymentsList",value:function(){var e=this,t=this.state,n=t.payments,o=t.chosePaymentName,r=t.choseName,a=this.props.trade;if(o)return null;var i=n.balance&&n.balance.amount,s=a.info.total,c=n.wechat&&n.wechat.enable,l=n.balance&&n.balance.enable,u=n.balance&&!n.balance.enable,m=i>=s?"使用余额（剩余 "+(i/100).toFixed(2)+"）":"微信支付",p=i>=s?"wallet":"wechatPayment",d="PaymentItem-"+(i>=s?"wallet":"wechatPayment");r&&(m="wechat"===r?"微信支付":"使用余额（剩余 "+(i/100).toFixed(2)+"）",p="wechat"===r?"wechatPayment":"wallet",d="PaymentItem-"+("wechat"===r?"wechatPayment":"wallet"));var f=C.a.createElement("div",null,C.a.createElement(N.a,{name:p,className:d}),C.a.createElement(P.c,{className:"Payment-Popover"},m),C.a.createElement(N.a,{className:"Select-arrow",name:"select"}));return C.a.createElement("div",{className:"PaymentsList"},C.a.createElement("span",{className:"Payment-Topline"}),C.a.createElement("span",{className:"PaymentWay"},"支付方式"),C.a.createElement(F.a,{placeholder:f},C.a.createElement(S.b,{plain:!0,className:"Payment-select",listClassName:"Payment-select-list",targetClassName:"Popover-targetContainer-verification",text:i>=s?"使用余额（剩余 "+(i/100).toFixed(2)+"）":"微信支付",menuToggler:f,onChange:function(t){"disabled"!==t&&e.setState({choseName:t})}},l&&C.a.createElement(S.a,{value:"balance",className:"PaymentItem"},C.a.createElement(N.a,{name:"wallet",className:"PaymentItem-wallet"}),"使用余额（剩余 "+(i/100).toFixed(2)+"）"),u&&C.a.createElement(S.a,{value:"disabled",className:"PaymentItem PaymentItem--disabled"},C.a.createElement(N.a,{name:"wallet",className:"PaymentItem-wallet"}),"使用余额（剩余 "+(i/100).toFixed(2)+"）"),c&&C.a.createElement(S.a,{value:"wechat",className:"PaymentItem"},C.a.createElement(N.a,{name:"wechatPayment",className:"PaymentItem-wechatPayment"}),"微信支付"))),C.a.createElement("span",{className:"Payment-Bottomline"}),C.a.createElement(P.c,{className:"Payment-CheckedButton",onClick:this.confirmPayment},"确认支付"))}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,o=t.trade,r=this.state,a=r.payments,i=r.chosePaymentName,s=r.codeUrl,c=r.needSMS,l=r.isInProgress;return o?C.a.createElement("div",{className:k()("Payment",n)},Object.keys(a).length?this.renderPaymentsList():C.a.createElement("div",{className:"Payment-placeholder"},C.a.createElement(M,null)),"wechat"===i&&C.a.createElement("div",{className:"Payment-wechatPay"},C.a.createElement("div",{className:"Payment-wechatPayTitle"},C.a.createElement("i",{className:"icon icon-ic_wechatpay PaymentIconWechat"}),"微信支付"),!this.isInWechat&&C.a.createElement("div",null,"使用微信扫描二维码完成支付"),this.state.qrLoaded?C.a.createElement("span",{className:"Payment-qrWrapper"},C.a.createElement("img",{role:"presentation",src:"//www.zhihu.com/qrcode?url="+s,width:"150",height:"150"})):C.a.createElement("div",{className:"Payment-qrPlaceholder"},C.a.createElement(M,null),!this.isInWechat&&C.a.createElement("div",null,"正在生成二维码"),s&&C.a.createElement("img",{role:"presentation",src:"//www.zhihu.com/qrcode?url="+s,width:"1",height:"1",onLoad:this.onQrLoad}))),"balance"===i&&C.a.createElement("form",{onSubmit:this.onBalanceFormSubmit,className:"Payment-balancePay"},C.a.createElement("div",{className:"Payment-balancePayTitle"},C.a.createElement("i",{className:"icon icon-wallet PaymentIconWallet"}),"余额支付"),!c&&C.a.createElement("div",null,C.a.createElement("div",{className:"Payment-description"},"请输入 6 位数知乎支付密码，用于支付验证。"),C.a.createElement(L,{chars:this.state.passcode,onFocus:this.onPasscodeFocus,onChange:this.onPasscodeInput,maskChar:!0,onFinish:this.onPasscodeFinish,className:k()("Payment-tpass",{"Payment-errorInput":this.state.error,"Payment-progressing":l}),autoFocus:!0,ref:function(t){e.tpass=t}},l&&C.a.createElement(M,{className:"Payment-balancePaySpinner"}))),Boolean(c)&&C.a.createElement("div",{className:"Payment-balancePaySms"},C.a.createElement("div",{className:"Payment-balancePaySmsText"},String(c)),C.a.createElement("input",{onChange:this.onPasscodeInput,value:this.state.passcode,className:k()("Payment-sms","SimpleInput",{"Payment-errorInput":this.state.error}),type:"text",pattern:"\\d{6}",minLength:"6",maxLength:"6",title:"验证码应为 6 位数字",placeholder:"输入 6 位数验证码",required:!0,autoFocus:!0,ref:function(t){e.smsInput=t}}),this.state.smsTimer?C.a.createElement("button",{className:"Payment-sendSms",type:"button",disabled:!0},this.state.smsTimer," 秒后可重发"):C.a.createElement("button",{onClick:this.onSendSMSCode,className:"Payment-sendSms",type:"button"},"发送验证码")),C.a.createElement("div",{className:"Payment-balancePayFooter"},C.a.createElement("p",{className:"Payment-errorTip",style:{visibility:this.state.error?"visible":"hidden"}},this.state.error),Boolean(c)&&C.a.createElement(P.c,{color:"blue",disabled:l,className:"Payment-balancePayConfirmBtn",type:"submit"},"确认")),!c&&C.a.createElement("div",{className:"Payment-balancePayForget"},"如果忘记密码请邮件联系"," ",C.a.createElement("email",{className:"Payment-email"},"i@zhihu.com")))):C.a.createElement("div",{className:k()("Payment",n)},C.a.createElement("div",{className:"Payment-placeholder Payment-placehoder--empty"},C.a.createElement(M,null)))}}]),t}(C.a.Component);z.propTypes={trade:w.a.object,autoChooseSinglePayment:w.a.bool,onSuccess:w.a.func.isRequired,onFail:w.a.func,onError:w.a.func,onConfirmPayment:w.a.func},z.defaultProps={trade:null,onSuccess:function(){},onFail:function(){},onError:function(){},autoChooseSinglePayment:!0,className:""};var W=z,G=n(254),H="",K=null,Y=n(8);n(1639);n.d(t,"TipjarDialog",function(){return ee});var Q,J,Z=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),$=[200,500,1e3,5e3,1e4,2e4],X=100,ee=(J=Q=function(e){function t(e){v(this,t);var n=y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.lockScroll=function(){document.body.classList.add("scroll-locked"),n.scrollTop=window.scrollY,document.body.style.width="100%",document.body.style.position="fixed",document.body.style.top=-n.scrollTop+"px"},n.unlockScroll=function(){document.body.classList.remove("scroll-locked"),document.body.style.width=null,document.body.style.position=null,void 0!==n.scrollTop&&(window.scrollTo(0,n.scrollTop),n.scrollTop=void 0),document.body.style.top=null},n.onConfirmPayment=function(e){n.setState({chosePaymentName:e})},n.onPaySuccess=function(){n.props.onPaySuccess(),n.setState({chosePaymentName:!0,colseTijarDialogStatus:!0,trade:void 0,currentAmount:"",customButton:!1})},n.handleCustomAmount=function(){n.state.trade&&n.state.trade.dispose(),n.setState({showCustom:!0})},n.handleCustomChange=function(e){var t=e.target.value;Number(t)?n.setState({customAmount:Number(t)}):t.length||n.setState({customAmount:""})},n.handleCustomKeyUp=function(e){13===e.keyCode&&n.handleSubmitCustom()},n.handleSubmitCustom=function(){var e=n.state.customAmount*X;e>0&&e<5e4&&(n.setState({customButton:!0,showCustom:!1,colseTijarDialogStatus:!1}),n.createTrade(e))},n.closeModal=function(){n.state.trade&&n.state.trade.dispose(),n.setState(n.getDefaultState())},n.handleAmountButton=function(e){n.createTrade(e.currentTarget.dataset.amount),n.setState({colseTijarDialogStatus:!1,customButton:!1,showCustom:!1})},n.createTrade=function(e){n.setState({tradeLoading:!0,currentAmount:e});var t=n.props.ua;n.props.addReward(e,t.Wechat?"wechat":"normal"),n.setState({tradeLoading:!1})},n.colseTijarDialog=function(){n.setState({chosePaymentName:!0,colseTijarDialogStatus:!0,trade:void 0,currentAmount:""}),n.props.colseTijarDialog()},n.state=n.getDefaultState(),n}return b(t,e),Z(t,[{key:"componentDidMount",value:function(){this.showTip()}},{key:"componentDidUpdate",value:function(e){var t=e.TipjarRender,n=this.props,o=n.tradeNumber,r=n.type,a=n.isMobile,i=n.TipjarRender,s=this.state,c=s.trade,l=s.colseTijarDialogStatus,u="article"===r?11:17;if(o&&(!c||o!==c.tradeNo)&&!l){var m=new window.zhihu.pay.Trade(o,u);this.setState({trade:m})}a&&(!t&&i?this.lockScroll():t&&!i&&this.unlockScroll())}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.TipjarRender,n=e.isMobile;t&&this.props.removeTradeNumber(),t&&n&&this.unlockScroll()}},{key:"getDefaultState",value:function(){return{showCustom:!1,customAmount:"",currentAmount:"",showTipModal:!1,customButton:!1,chosePaymentName:!0,colseTijarDialogStatus:!1}}},{key:"showTip",value:function(){var e=this;h("https://pay.zhihu.com/api/js",function(){e.setState({showTipModal:!0})})}},{key:"renderAmountCustom",value:function(){var e=this.state,t=e.showCustom,n=e.customAmount,o=e.currentAmount,r=e.customButton;return C.a.createElement("div",{className:"Reward-TipjarDialog-amountCustom"},t?C.a.createElement("div",{className:"Reward-TipjarDialog-amountInput"},C.a.createElement("input",{name:"",type:"text",className:"SimpleInput",placeholder:"你想赞赏的金额（不超过 500）",value:n,onChange:this.handleCustomChange,onKeyUp:this.handleCustomKeyUp,ref:function(e){e&&e.focus()}}),C.a.createElement(P.c,{disabled:n<=0||n>500,color:"blue",preset:"primary",onClick:this.handleSubmitCustom},"确定"),C.a.createElement("div",{className:"Reward-TipjarDialog-error",style:{display:n>500?"block":"none"}},"不能超过 500 元")):C.a.createElement(P.c,{preset:"plain",className:r?"TipjarDialog-customButton-cheked":"TipjarDialog-customButton",onClick:this.handleCustomAmount},r?"自定义金额： ￥ "+o/X:"自定义金额"))}},{key:"renderTipjarDialog",value:function(){var e=this,t=this.props,n=t.author,o=n.name,r=n.avatarUrl,a=n.isOrg,i=n.urlToken,s=n.id,c=t.tagline,l=this.state.currentAmount;return C.a.createElement("div",{className:"Reward-TipjarDialog"},C.a.createElement("div",{className:"Reward-TipjarDialog-user"},C.a.createElement("a",{href:"/"+(a?"org":"people")+"/"+(i||s),className:"Reward-UserAvatar"},C.a.createElement("img",{src:r.replace("_is","_l"),className:"Reward-Avatar",alt:"当前用户"})),o),C.a.createElement("div",{className:"Reward-TipjarDialog-tagLine"},c),C.a.createElement("div",{className:"Reward-TipjarDialog-selectAmount"},C.a.createElement("div",{className:"Reward-TipjarDialog-amountList"},$.map(function(t){return C.a.createElement(P.c,{key:t,"data-amount":t,onClick:e.handleAmountButton,color:"red",className:k()({"Reward-Button-checked":Number(l)===t})},C.a.createElement("b",null,Number(l)===t?t/X+" 元":"￥ "+t/X))})),this.renderAmountCustom()))}},{key:"render",value:function(){var e=this.props,t=e.ua,n=e.TipjarRender,o=e.isMobile,r=e.tradeNumber,a=this.state,i=a.showCustom,s=a.tradeLoading,c=a.showTipModal,l=a.trade,u=a.chosePaymentName,m=o?I.a:_.b,p=o?"small":"default";return C.a.createElement(m,{overlay:!0,size:p,onClose:this.colseTijarDialog,className:"Reward-TipjarDialogModal"},n&&C.a.createElement("div",null,c&&u&&this.renderTipjarDialog(),(l||s)&&!i&&C.a.createElement(W,{trade:l,tradeNumber:r,ua:t,onSuccess:this.onPaySuccess,onConfirmPayment:this.onConfirmPayment})))}}]),t}(g.Component),Q.propTypes={author:w.a.object,tagline:w.a.string,colseTijarDialog:w.a.func,addReward:w.a.func,tradeNumber:w.a.number,removeTradeNumber:w.a.func,onPaySuccess:w.a.func,isMobile:w.a.bool,type:w.a.string},Q.defaultProps={tagline:Y.h},J)}});
//# sourceMappingURL=column.modals.375f6dcd1d1f3a34f78e.js.map