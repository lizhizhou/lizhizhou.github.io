define("www_question_detail",["throttle","ajax","objhelper","msg"],function(t,e,o,n){var i=function(){this.__name="QuestionList"};return i.prototype={constructor:i,unlogin:function(){swal({title:"用户尚未登录!",text:'用户尚未登录，点击<a href="'+page.goto_this_page+'" target="_blank">这里</a>登录',html:!0,showConfirmButton:!1,allowOutsideClick:!0})},eventHub:new Vue,vReport:function(){return this.reportComponent||(this.reportComponent=new Vue({el:"#v-report",methods:{report:function(t){"object"==typeof t&&this.$broadcast("onReport",t)},removeReport:function(){this.$broadcast("closeWindow")}}})),this.reportComponent},initCKEditor:function(t){this.editor=CKEDITOR.replace("txt_answner",{height:161,extraPlugins:"uploadimage,flash,video"}),this.editor.on("change",function(e){t.$data.body=e.editor.getData()}),this.editor.on("key",function(e){var o=e.data.domEvent.$;(o.metaKey||o.ctrlKey)&&13===o.keyCode&&t.submit()})},initAnswerForm:function(){var t=this;new Vue({el:"#form_answer",data:function(){return{question:0,body:"",user:"",tipMsg:""}},methods:{submit:function(){var n=this;return page.g_user_login?n.$data.body?void e.post("/action/question/answer",o.copy(n.$data,["tipMsg"]),function(o){var n="string"==typeof o?JSON.parse(o):o;return 1===n.error?swal({title:"服务器消息!",text:n.msg,timer:2e3,html:!0,showConfirmButton:!1}):(t.editor.setData(""),void e.post("/question/_widgets/_answer",{_answer_id:n.id},function(t){$("#anser_list").append(t),$("#question_comment_total_count").html(n.answer_count)}))}):swal({title:"",text:"内容不能为空",timer:2e3,html:!0,type:"error",allowOutsideClick:!0,showConfirmButton:!1}):void t.unlogin()}},ready:function(){t.initCKEditor(this)}})},highlight:function(){$("pre").each(function(t,e){var o,n,i=$(this),s=i.attr("class");s&&(o=s.match(/brush:([^;]+);/),o.length>1&&(n=o[o.length-1],i.attr("class","hljs "+n),hljs.highlightBlock(e)))}),$("pre").each(function(t,e){hljs.highlightBlock(e)})},report:function(t,e,o){var n=this,i=n.vReport();i.report({obj_id:t,obj_type:e,url:o,user_code:n.user_code})},deleteQuestion:function(t,o){var n=this;swal({title:"危险操作(即将删除一条问答)",text:"您正在执行一项危险的操作!删除问答后，数据将无法恢复！如果您仍有疑虑，请点击取消项。",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes,删除!",cancelButtonText:"No,取消!",closeOnConfirm:!1},function(){return page.g_user_login?void e.post("/action/question/delete",{id:t,hash:o,user_code:n.user_code},function(t){t||(location.href="/question"),swal({title:"服务器消息!",text:t,timer:2e3,showConfirmButton:!1})}):void n.unlogin()})},setQuestionAsTop:function(t,o){var n=this;return page.g_user_login?void e.post("/action/question/mark_as_top",{id:t,top:o,user_code:n.user_code},function(t){swal({title:"操作成功!",text:t,type:"success",timer:2e3,showConfirmButton:!1})}):void n.unlogin()},open:function(t){$.fancybox({width:"auto",height:"auto",href:t,type:"ajax",ajax:{dataType:"html",headers:{"X-fancyBox":!0}},afterClose:function(){location.reload()}})},vote:function(t,o,n,i){var s=this;return page.g_user_login?void e.post(i?i:"/action/question/vote",{user:this.g_user_id,user_code:this.user_code,id:o,vote:n},function(e){var o,i,s,r="string"==typeof e?JSON.parse(e):e;return 1===r.error?swal({title:"服务器消息!",text:r.msg,timer:2e3,showConfirmButton:!1}):(o=$(t),i=n?o.next():o.prev(),s=parseInt(i.text()),n?r.vote_up||r.vote?i.text(s+1):i.text(s-1):r.vote_down||r.vote?i.text(s-1):i.text(s+1),swal.close(),void o.toggleClass("on"))}):void s.unlogin()},voteAnswer:function(t,e,o){var n=this,i="/action/question/vote_answer";return page.g_user_login?o?void n.vote(t,e,o,i):void swal({title:"操作提示！",text:"此操作将会扣掉你1个积分,是否继续?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes,确定!",cancelButtonText:"No,取消!",closeOnConfirm:!1},function(){n.vote(t,e,o,i)}):void n.unlogin()},commentAnswer:function(t,o,n){var i=this;return page.g_user_login?void e.post("/question/_widgets/_ajax_reply_to_post",{id:t,refer:o},function(o){swal({title:"回复评论",text:o,html:!0,type:"",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonText:"评论",cancelButtonText:"取消评论",allowOutsideClick:!0},function(){var o=$("#reply_answer").val();return o?void e.post("/action/question/reply_to_post",{parent:t,user:i.g_user_id,body:o},function(o){var i="string"==typeof o?JSON.parse(o):o;return 1===i.error?swal({title:"服务器消息!",text:i.msg,timer:2e3,showConfirmButton:!1}):void e.post("/question/_widgets/_answer_replies",{answer:t,rp:1},function(t){swal.close(),$(n).html(t)})}):swal.showInputError("评论不能为空")})}):void i.unlogin()},addQuestion:function(t){var o=this;return page.g_user_login?void e.post("/question/_widgets/_ajax_add_additional_remark",{id:t},function(o){swal({title:"补充话题",text:o,html:!0,type:"",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonText:"补充话题",cancelButtonText:"取消",allowOutsideClick:!0},function(){var o=$("#reply_answer").val();return o?void e.post("/action/question/add_detail",{question:t,body:o},function(o){return o?void swal({title:"服务器消息!",text:o,timer:2e3,showConfirmButton:!1}):e.post("/question/_widgets/_additional_remarks",{qid:t},function(t){$("#additional_remarks").html(t),swal({title:"补充话题成功!",text:"您已成功追加了一条补充话题.",type:"success",timer:2e3,showConfirmButton:!1})})}):swal.showInputError("评论不能为空")})}):void o.unlogin()},deleteAdditional:function(t,o){var n=this;return page.g_user_login?void swal({title:"危险操作(即将删除一条补充话题)",text:"您正在执行一项危险的操作!删除补充话题后，数据将无法恢复！如果您仍有疑虑，请点击取消项。",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes,删除!",cancelButtonText:"No,取消!",closeOnConfirm:!1},function(){e.post("/action/question/delete_detail",{id:t,user_code:n.user_code},function(t){return t?void swal({title:"服务器消息!",text:t,timer:2e3,showConfirmButton:!1}):e.post("/question/_widgets/_additional_remarks",{qid:o},function(t){$("#additional_remarks").html(t),swal({title:"删除评论成功!",text:"您已删除了一条补充话题.",type:"success",timer:2e3,showConfirmButton:!1})})})}):void n.unlogin()},toggleMoreAdditional:function(t){var e=$(t),o=e.data();$("#additional_remarks .additional_remark_row.more").toggleClass("hide"),e.data("show",!o.show),o.show?e.html("收起"):e.html("显示更多("+o.count+")")},deleteAnswer:function(t,o,n){var i=this;return page.g_user_login?void swal({title:"危险操作(即将删除此评论条目)",text:"您正在执行一项危险的操作!删除此评论条目后，数据将无法恢复！如果您仍有疑虑，请点击取消项。",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes,删除!",cancelButtonText:"No,取消!",closeOnConfirm:!1},function(){e.post("/action/question/delete_answer",{id:t,hash:o,user_code:i.user_code},function(t){var e=t&&"string"==typeof t?JSON.parse(t):t;return e&&1===e.error?swal({title:"服务器消息!",text:e.msg,timer:2e3,showConfirmButton:!1}):(swal({title:"删除评论成功!",text:"您已删除了此评论条目.",type:"success",timer:2e3,showConfirmButton:!1}),void $(n).remove())})}):void i.unlogin()},deleteReplyAnswer:function(t,o,n,i,s){var r=this;return page.g_user_login?void swal({title:"危险操作(即将删除此评论条目)",text:"您正在执行一项危险的操作!删除此评论条目后，数据将无法恢复！如果您仍有疑虑，请点击取消项。",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes,删除!",cancelButtonText:"No,取消!",closeOnConfirm:!1},function(){e.post("/action/question/delete_answer",{id:o,hash:n,user_code:r.user_code},function(o){var n=o&&"string"==typeof o?JSON.parse(o):o;return n&&1===n.error?swal({title:"服务器消息!",text:n.msg,timer:2e3,showConfirmButton:!1}):(swal({title:"删除评论成功!",text:"您已删除了此评论条目.",type:"success",timer:2e3,showConfirmButton:!1}),void e.post("/question/_widgets/_answer_replies",{answer:t,rp:i},function(t){swal.close(),$(s).html(t)}))})}):void r.unlogin()},replyPage:function(t,o,n){var i=this;return page.g_user_login?void e.post("/question/_widgets/_answer_replies",{answer:t,rp:o},function(t){$(n).html(t)}):void i.unlogin()},markAsBest:function(t,o,n){var i=this;return page.g_user_login?void e.post("/action/question/mark_as_best_v2",{id:o,user_code:i.user_code},function(e){var o="string"==typeof e?JSON.parse(e):e,i=$(n),s=$(t);o.result&&(i.toggleClass("best_solution"),s.toggleClass("on")),swal({title:"服务器消息!",text:o.msg,timer:2e3,showConfirmButton:!1})}):void i.unlogin()},removeFavorite:function(t,o){var n,i=$(t);i.hasClass("on")&&(n=this,swal({title:"危险操作(即将取消收藏)",text:"您正在执行一项危险的操作!取消收藏后，在您的收藏列表中无法查看到此条目！如果您仍有疑虑，请点击取消项。",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes,取消收藏!",cancelButtonText:"No,取消!",closeOnConfirm:!1},function(){e.post("/action/favorite/cancel",{id:o,type:2,user:n.g_user_id},function(t){var e=t&&"string"==typeof t?JSON.parse(t):t;return e&&1===e.error?swal({title:"服务器消息!",text:e.msg,timer:2e3,showConfirmButton:!1}):(swal({title:"成功取消收藏!",text:"您已成功取消了收藏.",type:"success",timer:2e3,showConfirmButton:!1}),i.removeClass("on"),i.html('<span class="collect-count">收藏('+t+")</span>"),void n.eventHub.$emit("ttenable",{}))})}))},initPoolForm:function(){var t=this,e=$("#pool_submit_button");$("#form_pool").ajaxForm({dataType:"json",beforeSubmit:function(){return page.g_user_login?"voted"===e.data("status")?(swal({title:"服务器消息!",text:"您已投过票，感谢参与。",timer:2e3,showConfirmButton:!1}),!1):0===$("input:checked").length?(swal({title:"操作提示!",text:"您还没有选择任何一项.",timer:2e3,showConfirmButton:!1}),!1):void e.attr("disabled","disabled"):(t.unlogin(),!1)},success:function(t){e.removeAttr("disabled"),t.msg?swal({title:"服务器消息!",text:t.msg,timer:2e3,showConfirmButton:!1}):"ok"===t.status&&swal({title:"服务器消息!",text:"投票成功。",type:"success",timer:2e3,showConfirmButton:!0,confirmButtonText:"确定"},function(t){t&&window.location.reload(!0)})}})},sendMsg:function(t){var o=this;return page.g_user_login?void e.post("/question/_widgets/_ajax_send_msg",{to:t},function(o){swal({title:"发送私信",text:o,html:!0,type:"",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonText:"发送",cancelButtonText:"取消",allowOutsideClick:!0},function(){var o=$("#ta_msg_content").val();return o?void e.post("/action/msg/send",{receiver:t,content:o},function(t){var e="string"==typeof t?JSON.parse(t):t;return 1===e.error?swal({title:"服务器消息!",text:e.msg,timer:2e3,showConfirmButton:!1}):void swal({title:"操作成功!",text:"私信已发送。",type:"success",timer:2e3,showConfirmButton:!1})}):swal.showInputError("私信不能为空")})}):void o.unlogin()},initFollow:function(){if(!(document.querySelector("#v-follow")instanceof HTMLElement))return this;var t=this;new Vue({el:"#v-follow",data:function(){return{id:0,user_code:"",status:""}},methods:{follow:function(){if(!page.g_user_login)return void t.unlogin();if(this.status){var o=this,n="follow"===o.status?"/action/user/followV2":"/action/user/unfollowV2";e.post(n,{id:o.id,user_code:o.user_code},function(t){var e="string"==typeof t?JSON.parse(t):t;return e.result?(o.status="follow"===o.status?"unfollow":"follow",o.$els.span.innerText=e.data.followTip,void(o.$els.span.dataset.origin=e.data.followTip)):void swal({title:"服务器消息!",text:e.msg,timer:2e3,showConfirmButton:!1})})}},showOperation:function(){var t=this,e=t.$els.span.innerText;switch(e){case"互相关注":t.$els.span.innerText="取消关注";break;case"已关注":t.$els.span.innerText="取消关注";break;case"未关注":t.$els.span.innerText="关注"}},recoverOperation:function(){var t=this;t.$els.span.innerText=t.$els.span.dataset.origin}}})},ready:function(){var t=this,e=$("#loading-effect").html();$(".tooltipstered").tooltipster({theme:"tooltipster-shadow",content:e,contentAsHTML:!0,interactive:!0,zIndex:10,delay:500,functionInit:function(o,n){var i=$(n.origin),s=i.data("tooltipster");o.content(e),s&&(s="string"==typeof s?JSON.parse(s):s,Object.keys(s).forEach(function(t){o.option(t,s[t])})),t.eventHub.$on("ttclose",function(){o.close(),o.disable()}),t.eventHub.$on("ttenable",function(){o.enable()}),i.hasClass("collect_question")&&i.hasClass("on")&&(o.close(),o.disable())},functionBefore:function(t,o){var n=$(o.origin),i=n.data();i.loaded===!0&&t.content(e),$.get(i.ajax,function(e){setTimeout(function(){t.content(e?e:"读取数据异常，请稍后再试！")},1e3),i.loaded=!0})}}),this.g_user_login&&n.polling(this.polling_msg_tips_url)},initPJAX:function(){$.pjax.defaults.timeout=1e4,$.pjax.defaults.maxCacheLength=2e3;var t=$("#answer_list_content_pjax");t.delegate("ul.paging a","click",function(t){$.pjax.click(t,{container:"#answer_list_content_pjax"})}),t.delegate(".answer_sort","click",function(t){$.pjax.click(t,{container:"#answer_list_content_pjax"})}),t.delegate(".last_answers","click",function(t){$.pjax.click(t,{container:"#answer_list_content_pjax"})}),$(document).on("pjax:send",function(){}),$(document).on("pjax:complete",function(){t[0].scrollIntoView()})},goToTop:function(){$(window).on("scroll",function(){$(this).scrollTop()>0?$(".tool-top").css("display","block"):$(".tool-top").css("display","none")}),$(".tool-top").on("click",function(t){return t.preventDefault(),$("html,body").animate({scrollTop:0},200),!1}),$(".tool-top").on("mouseover",function(t){$(".tool-top .icon").slideUp()}),$(".tool-top").on("mouseleave",function(t){$(".tool-top .icon").slideDown()})},resetImageSizeInQuestionContent:function(){$(".content-container img").each(function(){var t=$(this),e=t.attr("width");e>0&&t.css({width:e+"px",maxWidth:"100%"})})},register:function(){AOS.init(),this.highlight(),this.initAnswerForm(),this.initPoolForm(),this.initPJAX(),this.initFollow(),location.href.indexOf("&p=")>-1&&$("#answer_list_content_pjax")[0].scrollIntoView(),this.goToTop(),this.resetImageSizeInQuestionContent()}},i});